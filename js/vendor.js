(function(){var t=this,e=e||{};return e.game=null,e.WEBGL_RENDERER=0,e.CANVAS_RENDERER=1,e.VERSION="v2.2.9",e._UID=0,"undefined"!=typeof Float32Array?(e.Float32Array=Float32Array,e.Uint16Array=Uint16Array,e.Uint32Array=Uint32Array,e.ArrayBuffer=ArrayBuffer):(e.Float32Array=Array,e.Uint16Array=Array),e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RETINA_PREFIX="@2x",e.DisplayObject=function(){this.position=new e.Point(0,0),this.scale=new e.Point(1,1),this.pivot=new e.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new e.Matrix,this.worldPosition=new e.Point(0,0),this.worldScale=new e.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new e.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},e.DisplayObject.prototype.constructor=e.DisplayObject,e.DisplayObject.prototype={destroy:function(){if(this.children){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game)return this;var i=this.parent;t?i=t:this.parent||(i=this.game.world);var r,o,s,n,a,h,c=i.worldTransform,l=this.worldTransform;return this.rotation%e.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),r=this._cr*this.scale.x,o=this._sr*this.scale.x,s=-this._sr*this.scale.y,n=this._cr*this.scale.y,a=this.position.x,h=this.position.y,(this.pivot.x||this.pivot.y)&&(a-=this.pivot.x*r+this.pivot.y*s,h-=this.pivot.x*o+this.pivot.y*n),l.a=r*c.a+o*c.c,l.b=r*c.b+o*c.d,l.c=s*c.a+n*c.c,l.d=s*c.b+n*c.d,l.tx=a*c.a+h*c.c+c.tx,l.ty=a*c.b+h*c.d+c.ty):(r=this.scale.x,n=this.scale.y,a=this.position.x-this.pivot.x*r,h=this.position.y-this.pivot.y*n,l.a=r*c.a,l.b=r*c.b,l.c=n*c.c,l.d=n*c.d,l.tx=a*c.a+h*c.c+c.tx,l.ty=a*c.b+h*c.d+c.ty),this.worldAlpha=this.alpha*i.worldAlpha,this.worldPosition.set(l.tx,l.ty),this.worldScale.set(this.scale.x*Math.sqrt(l.a*l.a+l.c*l.c),this.scale.y*Math.sqrt(l.b*l.b+l.d*l.d)),this.worldRotation=Math.atan2(-l.c,l.d),this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,l,c),this},preUpdate:function(){},generateTexture:function(t,i,r){var o=this.getLocalBounds(),s=new e.RenderTexture(0|o.width,0|o.height,r,i,t);return e.DisplayObject._tempMatrix.tx=-o.x,e.DisplayObject._tempMatrix.ty=-o.y,s.render(this,e.DisplayObject._tempMatrix),s},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(t){return this.updateTransform(),this.worldTransform.apply(t)},toLocal:function(t,e){return e&&(t=e.toGlobal(t)),this.updateTransform(),this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(t.width=Math.max(1,Math.ceil(t.width)),t.height=Math.max(1,Math.ceil(t.height)),this.updateTransform(),this._cachedSprite)this._cachedSprite.texture.resize(t.width,t.height);else{var i=new e.RenderTexture(t.width,t.height);this._cachedSprite=new e.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null,this._cachedSprite.filters=r,e.DisplayObject._tempMatrix.tx=-t.x,e.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._filters=r,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform,Object.defineProperties(e.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(this.visible){var t=this.parent;if(!t)return this.visible;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}return!1}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,t&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){for(var i=[],r=0;r<t.length;r++)for(var o=t[r].passes,s=0;s<o.length;s++)i.push(o[s]);this._filterBlock={target:this,filterPasses:i}}this._filters=t,this.blendMode&&this.blendMode===e.blendModes.MULTIPLY&&(this.blendMode=e.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}}),e.DisplayObjectContainer=function(){e.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype),e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer,e.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},e.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},e.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[r]=t}},e.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},e.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},e.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(e!==-1)return this.removeChildAt(e)},e.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(e.parent=void 0,this.children.splice(t,1)),e},e.DisplayObjectContainer.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i=e-t;if(i>0&&i<=e){for(var r=this.children.splice(begin,i),o=0;o<r.length;o++){var s=r[o];s.parent=void 0}return r}if(0===i&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform,e.DisplayObjectContainer.prototype.getBounds=function(t){var i=t&&t instanceof e.DisplayObject,r=!0;i?r=t instanceof e.DisplayObjectContainer&&t.contains(this):t=this;var o;if(i){var s=t.worldTransform;for(t.worldTransform=e.identityMatrix,o=0;o<t.children.length;o++)t.children[o].updateTransform()}var n,a,h,c=1/0,l=1/0,u=-(1/0),p=-(1/0),d=!1;for(o=0;o<this.children.length;o++){var f=this.children[o];f.visible&&(d=!0,n=this.children[o].getBounds(),c=c<n.x?c:n.x,l=l<n.y?l:n.y,a=n.width+n.x,h=n.height+n.y,u=u>a?u:a,p=p>h?p:h)}var v=this._bounds;if(!d){v=new e.Rectangle;var g=v.x,y=v.width+v.x,m=v.y,b=v.height+v.y,x=this.worldTransform,A=x.a,E=x.b,B=x.c,S=x.d,T=x.tx,w=x.ty,R=A*y+B*b+T,C=S*b+E*y+w,P=A*g+B*b+T,L=S*b+E*g+w,_=A*g+B*m+T,M=S*m+E*g+w,F=A*y+B*m+T,I=S*m+E*y+w;u=R,p=C,c=R,l=C,c=P<c?P:c,c=_<c?_:c,c=F<c?F:c,l=L<l?L:l,l=M<l?M:l,l=I<l?I:l,u=P>u?P:u,u=_>u?_:u,u=F>u?F:u,p=L>p?L:p,p=M>p?M:p,p=I>p?I:p}if(v.x=c,v.y=l,v.width=u-c,v.height=p-l,i)for(t.worldTransform=s,o=0;o<t.children.length;o++)t.children[o].updateTransform();if(!r){var q=t.getBounds();v.x-=q.x,v.y-=q.y}return v},e.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},e.DisplayObjectContainer.prototype.contains=function(t){return!!t&&(t===this||this.contains(t.parent))},e.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);var e;if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t)}},e.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0;e<this.children.length;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;0!==e?this.scale.x=t/e:this.scale.x=1,this._width=t}}),Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;0!==e?this.scale.y=t/e:this.scale.y=1,this._height=t}}),e.Sprite=function(t){e.DisplayObjectContainer.call(this),this.anchor=new e.Point,this.texture=t||e.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=e.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Sprite.prototype.constructor=e.Sprite,Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Sprite.prototype.setTexture=function(t,e){void 0!==e&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=t,this.texture.valid=!0,this.cachedTint=-1},e.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},e.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,r=e*(1-this.anchor.x),o=e*-this.anchor.x,s=i*(1-this.anchor.y),n=i*-this.anchor.y,a=t||this.worldTransform,h=a.a,c=a.b,l=a.c,u=a.d,p=a.tx,d=a.ty,f=-(1/0),v=-(1/0),g=1/0,y=1/0;if(0===c&&0===l){if(h<0){h*=-1;var m=r;r=-o,o=-m}if(u<0){u*=-1;var m=s;s=-n,n=-m}g=h*o+p,f=h*r+p,y=u*n+d,v=u*s+d}else{var b=h*o+l*n+p,x=u*n+c*o+d,A=h*r+l*n+p,E=u*n+c*r+d,B=h*r+l*s+p,S=u*s+c*r+d,T=h*o+l*s+p,w=u*s+c*o+d;g=b<g?b:g,g=A<g?A:g,g=B<g?B:g,g=T<g?T:g,y=x<y?x:y,y=E<y?E:y,y=S<y?S:y,y=w<y?w:y,f=b>f?b:f,f=A>f?A:f,f=B>f?B:f,f=T>f?T:f,v=x>v?x:v,v=E>v?E:v,v=S>v?S:v,v=w>v?w:v}var R=this._bounds;return R.x=g,R.width=f-g,R.y=y,R.height=v-y,this._currentBounds=R,R},e.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=e.identityMatrix;for(var i=0;i<this.children.length;i++)this.children[i].updateTransform();var r=this.getBounds();for(this.worldTransform=t,i=0;i<this.children.length;i++)this.children[i].updateTransform();return r},e.Sprite.prototype._renderWebGL=function(t,e){if(this.visible&&!(this.alpha<=0)&&this.renderable){var i=this.worldTransform;if(e&&(i=e),this._mask||this._filters){var r=t.spriteBatch;this._filters&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),r.render(this);for(var o=0;o<this.children.length;o++)this.children[o]._renderWebGL(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),r.start()}else{t.spriteBatch.render(this);for(var o=0;o<this.children.length;o++)this.children[o]._renderWebGL(t,i)}}},e.Sprite.prototype._renderCanvas=function(t,i){if(!(!this.visible||0===this.alpha||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var r=this.worldTransform;if(i&&(r=i),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var o=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===e.scaleModes.LINEAR);var s=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,n=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,a=r.tx*t.resolution+t.shakeX,h=r.ty*t.resolution+t.shakeY;t.roundPixels?(t.context.setTransform(r.a,r.b,r.c,r.d,0|a,0|h),s|=0,n|=0):t.context.setTransform(r.a,r.b,r.c,r.d,a,h);var c=this.texture.crop.width,l=this.texture.crop.height;if(s/=o,n/=o,16777215!==this.tint)(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),t.context.drawImage(this.tintedTexture,0,0,c,l,s,n,c/o,l/o);else{var u=this.texture.crop.x,p=this.texture.crop.y;t.context.drawImage(this.texture.baseTexture.source,u,p,c,l,s,n,c/o,l/o)}}for(var d=0;d<this.children.length;d++)this.children[d]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.SpriteBatch=function(t){e.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype),e.SpriteBatch.prototype.constructor=e.SpriteBatch,e.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(t),this.ready=!0},e.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},e.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},e.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,r=!0,o=0;o<this.children.length;o++){var s=this.children[o];if(s.visible){var n=s.texture,a=n.frame;if(e.globalAlpha=this.worldAlpha*s.alpha,s.rotation%(2*Math.PI)===0)r&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),r=!1),e.drawImage(n.baseTexture.source,a.x,a.y,a.width,a.height,s.anchor.x*(-a.width*s.scale.x)+s.position.x+.5+t.shakeX|0,s.anchor.y*(-a.height*s.scale.y)+s.position.y+.5+t.shakeY|0,a.width*s.scale.x,a.height*s.scale.y);else{r||(r=!0),s.displayObjectUpdateTransform();var h=s.worldTransform,c=h.tx*t.resolution+t.shakeX,l=h.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,0|c,0|l):e.setTransform(h.a,h.b,h.c,h.d,c,l),e.drawImage(n.baseTexture.source,a.x,a.y,a.width,a.height,s.anchor.x*-a.width+.5|0,s.anchor.y*-a.height+.5|0,a.width,a.height)}}}}},e.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},e.canUseNewCanvasBlendModes=function(){if(void 0===document)return!1;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",i="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",r=new Image;r.src=t+"AP804Oa6"+i;var o=new Image;o.src=t+"/wCKxvRF"+i;var s=e.CanvasPool.create(this,6,1),n=s.getContext("2d");if(n.globalCompositeOperation="multiply",n.drawImage(r,0,0),n.drawImage(o,2,0),!n.getImageData(2,0,1,1))return!1;var a=n.getImageData(2,0,1,1).data;return e.CanvasPool.remove(this),255===a[0]&&0===a[1]&&0===a[2]},e.getNextPowerOfTwo=function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},e.isPowerOfTwo=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},e.CanvasPool={create:function(t,i,r){var o,s=e.CanvasPool.getFirst();if(s===-1){var n={parent:t,canvas:document.createElement("canvas")};e.CanvasPool.pool.push(n),o=n.canvas}else e.CanvasPool.pool[s].parent=t,o=e.CanvasPool.pool[s].canvas;return void 0!==i&&(o.width=i,o.height=r),o},getFirst:function(){for(var t=e.CanvasPool.pool,i=0;i<t.length;i++)if(!t[i].parent)return i;return-1},remove:function(t){for(var i=e.CanvasPool.pool,r=0;r<i.length;r++)i[r].parent===t&&(i[r].parent=null,i[r].canvas.width=1,i[r].canvas.height=1)},removeByCanvas:function(t){for(var i=e.CanvasPool.pool,r=0;r<i.length;r++)i[r].canvas===t&&(i[r].parent=null,i[r].canvas.width=1,i[r].canvas.height=1)},getTotal:function(){for(var t=e.CanvasPool.pool,i=0,r=0;r<t.length;r++)t[r].parent&&i++;return i},getFree:function(){for(var t=e.CanvasPool.pool,i=0,r=0;r<t.length;r++)t[r].parent||i++;return i}},e.CanvasPool.pool=[],e.initDefaultShaders=function(){},e.CompileVertexShader=function(t,i){return e._CompileShader(t,i,t.VERTEX_SHADER)},e.CompileFragmentShader=function(t,i){return e._CompileShader(t,i,t.FRAGMENT_SHADER)},e._CompileShader=function(t,e,i){var r=e;Array.isArray(e)&&(r=e.join("\n"));var o=t.createShader(i);return t.shaderSource(o,r),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(window.console.log(t.getShaderInfoLog(o)),null)},e.compileProgram=function(t,i,r){var o=e.CompileFragmentShader(t,r),s=e.CompileVertexShader(t,i),n=t.createProgram();return t.attachShader(n,s),t.attachShader(n,o),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||(window.console.log(t.getProgramInfoLog(n)),window.console.log("Could not initialise shaders")),n},e.PixiShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},e.PixiShader.prototype.constructor=e.PixiShader,e.PixiShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms(),this.program=i},e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];var r=t.type;"sampler2D"===r?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===r||"mat3"===r||"mat4"===r?(t.glMatrix=!0,t.glValueLength=1,"mat2"===r?t.glFunc=e.uniformMatrix2fv:"mat3"===r?t.glFunc=e.uniformMatrix3fv:"mat4"===r&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+r],"2f"===r||"2i"===r?t.glValueLength=2:"3f"===r||"3i"===r?t.glValueLength=3:"4f"===r||"4i"===r?t.glValueLength=4:t.glValueLength=1)}},e.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,r=i.magFilter?i.magFilter:e.LINEAR,o=i.minFilter?i.minFilter:e.LINEAR,s=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,n=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,a=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(s=e.REPEAT,n=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,c=i.height?i.height:2,l=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,a,h,c,l,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,i=this.gl;for(var r in this.uniforms)t=this.uniforms[r],1===t.glValueLength?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?e.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],e.PixiFastShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},e.PixiFastShader.prototype.constructor=e.PixiFastShader,e.PixiFastShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.uMatrix=t.getUniformLocation(i,"uMatrix"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord"),this.aScale=t.getAttribLocation(i,"aScale"),this.aRotation=t.getAttribLocation(i,"aRotation"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.StripShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},e.StripShader.prototype.constructor=e.StripShader,e.StripShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.PrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},e.PrimitiveShader.prototype.constructor=e.PrimitiveShader,e.PrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.ComplexPrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader,e.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.color=t.getUniformLocation(i,"color"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.glContexts=[],e.instances=[],e.WebGLRenderer=function(t){this.game=t,e.defaultRenderer||(e.defaultRenderer=this),this.type=e.WEBGL_RENDERER,this.resolution=t.resolution,this.transparent=t.transparent,this.autoResize=!1,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.clearBeforeRender=t.clearBeforeRender,this.width=t.width,this.height=t.height,this.view=t.canvas,this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new e.Point,this.offset=new e.Point,this.shaderManager=new e.WebGLShaderManager,this.spriteBatch=new e.WebGLSpriteBatch,this.maskManager=new e.WebGLMaskManager,this.filterManager=new e.WebGLFilterManager,this.stencilManager=new e.WebGLStencilManager,this.blendModeManager=new e.WebGLBlendModeManager,this.renderSession={},this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,
this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},e.WebGLRenderer.prototype.constructor=e.WebGLRenderer,e.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=e.WebGLRenderer.glContextId++,e.glContexts[this.glContextId]=t,e.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},e.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.game.clearBeforeRender&&(e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a),e.clear(e.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(t,this.projection)}},e.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r,o){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=r?-1:1,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),t._renderWebGL(this.renderSession,o),this.spriteBatch.end()},e.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},e.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded)return!1;var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&e.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,!0},e.WebGLRenderer.prototype.destroy=function(){e.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,e.CanvasPool.remove(this),e.instances[this.glContextId]=null,e.WebGLRenderer.glContextId--},e.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!e.blendModesWebGL){var i=[],r=e.blendModes;i[r.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],i[r.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],i[r.SCREEN]=[t.SRC_ALPHA,t.ONE],i[r.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL=i}},e.WebGLRenderer.glContextId=0,e.WebGLBlendModeManager=function(){this.currentBlendMode=99999},e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager,e.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},e.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=e.blendModesWebGL[this.currentBlendMode];return i&&this.gl.blendFunc(i[0],i[1]),!0},e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},e.WebGLMaskManager=function(){},e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager,e.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},e.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;t.dirty&&e.WebGLGraphics.updateGraphics(t,r),void 0!==t._webGL[r.id]&&void 0!==t._webGL[r.id].data&&0!==t._webGL[r.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)},e.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},e.WebGLMaskManager.prototype.destroy=function(){this.gl=null},e.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},e.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},e.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var r=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var o=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===e.mode?(r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-o,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(o+1),255):r.stencilFunc(r.EQUAL,o+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-o,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o+1,255):r.stencilFunc(r.EQUAL,255-(o+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},e.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var o,s=this.gl,n=r.projection,a=r.offset;1===i.mode?(o=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(o),s.uniform1f(o.flipY,r.flipY),s.uniformMatrix3fv(o.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform2f(o.projectionVector,n.x,-n.y),s.uniform2f(o.offsetVector,-a.x,-a.y),s.uniform3fv(o.tintColor,e.hex2rgb(t.tint)),s.uniform3fv(o.color,i.color),s.uniform1f(o.alpha,t.worldAlpha*i.alpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(o=r.shaderManager.primitiveShader,r.shaderManager.setShader(o),s.uniformMatrix3fv(o.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform1f(o.flipY,r.flipY),s.uniform2f(o.projectionVector,n.x,-n.y),s.uniform2f(o.offsetVector,-a.x,-a.y),s.uniform3fv(o.tintColor,e.hex2rgb(t.tint)),s.uniform1f(o.alpha,t.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(o.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},e.WebGLStencilManager.prototype.popStencil=function(t,e,i){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var o=this.count;this.bindGraphics(t,e,i),r.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(o+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o,255):r.stencilFunc(r.EQUAL,255-o,255)):(this.reverse?(r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(o+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o,255):r.stencilFunc(r.EQUAL,255-o,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},e.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},e.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager,e.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new e.PrimitiveShader(t),this.complexPrimitiveShader=new e.ComplexPrimitiveShader(t),this.defaultShader=new e.PixiShader(t),this.fastShader=new e.PixiFastShader(t),this.stripShader=new e.StripShader(t),this.setShader(this.defaultShader)},e.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var r=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?r.enableVertexAttribArray(e):r.disableVertexAttribArray(e))},e.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},e.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var t=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new e.ArrayBuffer(t),this.positions=new e.Float32Array(this.vertices),this.colors=new e.Uint32Array(this.vertices),this.indices=new e.Uint16Array(i),this.lastIndexCount=0;for(var r=0,o=0;r<i;r+=6,o+=4)this.indices[r+0]=o+0,this.indices[r+1]=o+1,this.indices[r+2]=o+2,this.indices[r+3]=o+0,this.indices[r+4]=o+2,this.indices[r+5]=o+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new e.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},e.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new e.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[t.id]=i},e.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},e.WebGLSpriteBatch.prototype.end=function(){this.flush()},e.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture,r=t.worldTransform;e&&(r=e),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture);var o=i._uvs;if(o){var s,n,a,h,c=t.anchor.x,l=t.anchor.y;if(i.trim){var u=i.trim;n=u.x-c*u.width,s=n+i.crop.width,h=u.y-l*u.height,a=h+i.crop.height}else s=i.frame.width*(1-c),n=i.frame.width*-c,a=i.frame.height*(1-l),h=i.frame.height*-l;var p=4*this.currentBatchSize*this.vertSize,d=i.baseTexture.resolution,f=r.a/d,v=r.b/d,g=r.c/d,y=r.d/d,m=r.tx,b=r.ty,x=this.colors,A=this.positions;this.renderSession.roundPixels?(A[p]=f*n+g*h+m|0,A[p+1]=y*h+v*n+b|0,A[p+5]=f*s+g*h+m|0,A[p+6]=y*h+v*s+b|0,A[p+10]=f*s+g*a+m|0,A[p+11]=y*a+v*s+b|0,A[p+15]=f*n+g*a+m|0,A[p+16]=y*a+v*n+b|0):(A[p]=f*n+g*h+m,A[p+1]=y*h+v*n+b,A[p+5]=f*s+g*h+m,A[p+6]=y*h+v*s+b,A[p+10]=f*s+g*a+m,A[p+11]=y*a+v*s+b,A[p+15]=f*n+g*a+m,A[p+16]=y*a+v*n+b),A[p+2]=o.x0,A[p+3]=o.y0,A[p+7]=o.x1,A[p+8]=o.y1,A[p+12]=o.x2,A[p+13]=o.y2,A[p+17]=o.x3,A[p+18]=o.y3;var E=t.tint;x[p+4]=x[p+9]=x[p+14]=x[p+19]=(E>>16)+(65280&E)+((255&E)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},e.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var i=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture),t._uvs||(t._uvs=new e.TextureUvs);var r=t._uvs,o=i.baseTexture.width,s=i.baseTexture.height;t.tilePosition.x%=o*t.tileScaleOffset.x,t.tilePosition.y%=s*t.tileScaleOffset.y;var n=t.tilePosition.x/(o*t.tileScaleOffset.x),a=t.tilePosition.y/(s*t.tileScaleOffset.y),h=t.width/o/(t.tileScale.x*t.tileScaleOffset.x),c=t.height/s/(t.tileScale.y*t.tileScaleOffset.y);r.x0=0-n,r.y0=0-a,r.x1=1*h-n,r.y1=0-a,r.x2=1*h-n,r.y2=1*c-a,r.x3=0-n,r.y3=1*c-a;var l=t.tint,u=(l>>16)+(65280&l)+((255&l)<<16)+(255*t.worldAlpha<<24),p=this.positions,d=this.colors,f=t.width,v=t.height,g=t.anchor.x,y=t.anchor.y,m=f*(1-g),b=f*-g,x=v*(1-y),A=v*-y,E=4*this.currentBatchSize*this.vertSize,B=i.baseTexture.resolution,S=t.worldTransform,T=S.a/B,w=S.b/B,R=S.c/B,C=S.d/B,P=S.tx,L=S.ty;p[E++]=T*b+R*A+P,p[E++]=C*A+w*b+L,p[E++]=r.x0,p[E++]=r.y0,d[E++]=u,p[E++]=T*m+R*A+P,p[E++]=C*A+w*m+L,p[E++]=r.x1,p[E++]=r.y1,d[E++]=u,p[E++]=T*m+R*x+P,p[E++]=C*x+w*m+L,p[E++]=r.x2,p[E++]=r.y2,d[E++]=u,p[E++]=T*b+R*x+P,p[E++]=C*x+w*b+L,p[E++]=r.x3,p[E++]=r.y3,d[E++]=u,this.sprites[this.currentBatchSize++]=t},e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,i=this.gl;if(this.dirty){this.dirty=!1,i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[i.id];var r=4*this.vertSize;i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,r,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,r,8),i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,r,16)}if(this.currentBatchSize>.5*this.size)i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);else{var o=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);i.bufferSubData(i.ARRAY_BUFFER,0,o)}for(var s,n,a,h,c=0,l=0,u=null,p=this.renderSession.blendModeManager.currentBlendMode,d=null,f=!1,v=!1,g=0,y=this.currentBatchSize;g<y;g++){h=this.sprites[g],s=h.tilingTexture?h.tilingTexture.baseTexture:h.texture.baseTexture,n=h.blendMode,a=h.shader||this.defaultShader,f=p!==n,v=d!==a;var m=s.skipRender;if(m&&h.children.length>0&&(m=!1),(u!==s&&!m||f||v)&&(this.renderBatch(u,c,l),l=g,c=0,u=s,f&&(p=n,this.renderSession.blendModeManager.setBlendMode(p)),v)){d=a,t=d.shaders[i.id],t||(t=new e.PixiShader(i),t.fragmentSrc=d.fragmentSrc,t.uniforms=d.uniforms,t.init(),d.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var b=this.renderSession.projection;i.uniform2f(t.projectionVector,b.x,b.y);var x=this.renderSession.offset;i.uniform2f(t.offsetVector,x.x,x.y)}c++}this.renderBatch(u,c,l),this.currentBatchSize=0}},e.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;if(t._dirty[r.id]){if(!this.renderSession.renderer.updateTexture(t))return}else r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]);r.drawElements(r.TRIANGLES,6*e,r.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},e.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},e.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var i=4*this.size*this.vertSize,r=6*this.maxSize;this.vertices=new e.Float32Array(i),this.indices=new e.Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var o=0,s=0;o<r;o+=6,s+=4)this.indices[o+0]=s+0,this.indices[o+1]=s+1,this.indices[o+2]=s+2,this.indices[o+3]=s+0,this.indices[o+4]=s+2,this.indices[o+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch,e.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},e.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var r=0,o=e.length;r<o;r++)this.renderSprite(e[r]);this.flush()}},e.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||t.texture.baseTexture.skipRender||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,r,o,s,n,a,h,c=this.vertices;if(e=t.texture._uvs,i=t.texture.frame.width,r=t.texture.frame.height,t.texture.trim){var l=t.texture.trim;s=l.x-t.anchor.x*l.width,o=s+t.texture.crop.width,a=l.y-t.anchor.y*l.height,n=a+t.texture.crop.height}else o=t.texture.frame.width*(1-t.anchor.x),s=t.texture.frame.width*-t.anchor.x,n=t.texture.frame.height*(1-t.anchor.y),a=t.texture.frame.height*-t.anchor.y;h=4*this.currentBatchSize*this.vertSize,c[h++]=s,c[h++]=a,c[h++]=t.position.x,c[h++]=t.position.y,c[h++]=t.scale.x,c[h++]=t.scale.y,c[h++]=t.rotation,c[h++]=e.x0,c[h++]=e.y1,c[h++]=t.alpha,c[h++]=o,c[h++]=a,c[h++]=t.position.x,c[h++]=t.position.y,c[h++]=t.scale.x,c[h++]=t.scale.y,c[h++]=t.rotation,c[h++]=e.x1,c[h++]=e.y1,c[h++]=t.alpha,c[h++]=o,c[h++]=n,c[h++]=t.position.x,c[h++]=t.position.y,c[h++]=t.scale.x,c[h++]=t.scale.y,c[h++]=t.rotation,c[h++]=e.x2,c[h++]=e.y2,c[h++]=t.alpha,c[h++]=s,c[h++]=n,c[h++]=t.position.x,c[h++]=t.position.y,c[h++]=t.scale.x,c[h++]=t.scale.y,c[h++]=t.rotation,c[h++]=e.x3,c[h++]=e.y3,c[h++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},e.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager,e.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},e.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},e.WebGLFilterManager.prototype.pushFilter=function(t){var i=this.gl,r=this.renderSession.projection,o=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new e.WebGLStencilManager,this.renderSession.stencilManager.setContext(i),i.disable(i.STENCIL_TEST),this.filterStack.push(t);var s=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var n=this.texturePool.pop();n?n.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):n=new e.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),i.bindTexture(i.TEXTURE_2D,n.texture);var a=t._filterArea,h=s.padding;a.x-=h,a.y-=h,a.width+=2*h,a.height+=2*h,a.x<0&&(a.x=0),a.width>this.width&&(a.width=this.width),a.y<0&&(a.y=0),a.height>this.height&&(a.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,n.frameBuffer),i.viewport(0,0,a.width*this.renderSession.resolution,a.height*this.renderSession.resolution),r.x=a.width/2,r.y=-a.height/2,o.x=-a.x,o.y=-a.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),t._glFilterTexture=n},e.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,i=this.filterStack.pop(),r=i._filterArea,o=i._glFilterTexture,s=this.renderSession.projection,n=this.renderSession.offset;if(i.filterPasses.length>1){t.viewport(0,0,r.width*this.renderSession.resolution,r.height*this.renderSession.resolution),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=r.height,this.vertexArray[2]=r.width,this.vertexArray[3]=r.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=r.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=o,h=this.texturePool.pop();h||(h=new e.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),h.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var c=0;c<i.filterPasses.length-1;c++){var l=i.filterPasses[c];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture),this.applyFilterPass(l,r,r.width,r.height);var u=a;a=h,h=u}t.enable(t.BLEND),o=a,this.texturePool.push(h)}var p=i.filterPasses[i.filterPasses.length-1];this.offsetX-=r.x,this.offsetY-=r.y;var d=this.width,f=this.height,v=0,g=0,y=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var m=this.filterStack[this.filterStack.length-1];r=m._filterArea,d=r.width,f=r.height,v=r.x,g=r.y,y=m._glFilterTexture.frameBuffer}s.x=d/2,s.y=-f/2,n.x=v,n.y=g,r=i._filterArea;var b=r.x-v,x=r.y-g;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=b,this.vertexArray[1]=x+r.height,this.vertexArray[2]=b+r.width,this.vertexArray[3]=x+r.height,this.vertexArray[4]=b,this.vertexArray[5]=x,this.vertexArray[6]=b+r.width,this.vertexArray[7]=x,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,d*this.renderSession.resolution,f*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,y),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=i._previous_stencil_mgr,i._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(p,r,d,f),this.texturePool.push(o),i._glFilterTexture=null},e.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,o){var s=this.gl,n=t.shaders[s.id];n||(n=new e.PixiShader(s),n.fragmentSrc=t.fragmentSrc,n.uniforms=t.uniforms,n.init(),t.shaders[s.id]=n),this.renderSession.shaderManager.setShader(n),s.uniform2f(n.projectionVector,r/2,-o/2),s.uniform2f(n.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),n.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(n.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(n.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(n.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},e.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new e.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new e.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new e.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},e.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},e.FilterTexture=function(t,i,r,o){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),o=o||e.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,o===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,r)},e.FilterTexture.prototype.constructor=e.FilterTexture,e.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},e.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},e.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},e.CanvasBuffer=function(t,i){this.width=t,this.height=i,this.canvas=e.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=i},e.CanvasBuffer.prototype.constructor=e.CanvasBuffer,e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},e.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},e.CanvasBuffer.prototype.destroy=function(){e.CanvasPool.remove(this)},e.CanvasMaskManager=function(){},e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager,e.CanvasMaskManager.prototype.pushMask=function(t,i){var r=i.context;r.save();var o=t.alpha,s=t.worldTransform,n=i.resolution;r.setTransform(s.a*n,s.b*n,s.c*n,s.d*n,s.tx*n,s.ty*n),e.CanvasGraphics.renderGraphicsMask(t,r),r.clip(),t.worldAlpha=o},e.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},e.CanvasTinter=function(){},e.CanvasTinter.getTintedTexture=function(t,i){var r=t.tintedTexture||e.CanvasPool.create(this);return e.CanvasTinter.tintMethod(t.texture,i,r),r},e.CanvasTinter.tintWithMultiply=function(t,e,i){var r=i.getContext("2d"),o=t.crop;i.width===o.width&&i.height===o.height||(i.width=o.width,i.height=o.height),r.clearRect(0,0,o.width,o.height),r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="multiply",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},e.CanvasTinter.tintWithPerPixel=function(t,i,r){var o=r.getContext("2d"),s=t.crop;r.width=s.width,r.height=s.height,o.globalCompositeOperation="copy",o.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var n=e.hex2rgb(i),a=n[0],h=n[1],c=n[2],l=o.getImageData(0,0,s.width,s.height),u=l.data,p=0;p<u.length;p+=4)if(u[p+0]*=a,u[p+1]*=h,u[p+2]*=c,!e.CanvasTinter.canHandleAlpha){var d=u[p+3];u[p+0]/=255/d,u[p+1]/=255/d,u[p+2]/=255/d}o.putImageData(l,0,0)},e.CanvasTinter.checkInverseAlpha=function(){var t=new e.CanvasBuffer(2,1);t.context.fillStyle="rgba(10, 20, 30, 0.5)",t.context.fillRect(0,0,1,1);var i=t.context.getImageData(0,0,1,1);if(null===i)return!1;t.context.putImageData(i,1,0);
var r=t.context.getImageData(1,0,1,1);return r.data[0]===i.data[0]&&r.data[1]===i.data[1]&&r.data[2]===i.data[2]&&r.data[3]===i.data[3]},e.CanvasTinter.canHandleAlpha=e.CanvasTinter.checkInverseAlpha(),e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes(),e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel,e.CanvasRenderer=function(t){this.game=t,e.defaultRenderer||(e.defaultRenderer=this),this.type=e.CANVAS_RENDERER,this.resolution=t.resolution,this.clearBeforeRender=t.clearBeforeRender,this.transparent=t.transparent,this.autoResize=!1,this.width=t.width*this.resolution,this.height=t.height*this.resolution,this.view=t.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new e.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},e.CanvasRenderer.prototype.constructor=e.CanvasRenderer,e.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):t._bgColor&&(this.context.fillStyle=t._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t)},e.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},e.CanvasRenderer.prototype.resize=function(t,i){this.width=t*this.resolution,this.height=i*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===e.scaleModes.LINEAR)},e.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession,i)},e.CanvasRenderer.prototype.mapBlendModes=function(){if(!e.blendModesCanvas){var t=[],i=e.blendModes,r=e.canUseNewCanvasBlendModes();t[i.NORMAL]="source-over",t[i.ADD]="lighter",t[i.MULTIPLY]=r?"multiply":"source-over",t[i.SCREEN]=r?"screen":"source-over",t[i.OVERLAY]=r?"overlay":"source-over",t[i.DARKEN]=r?"darken":"source-over",t[i.LIGHTEN]=r?"lighten":"source-over",t[i.COLOR_DODGE]=r?"color-dodge":"source-over",t[i.COLOR_BURN]=r?"color-burn":"source-over",t[i.HARD_LIGHT]=r?"hard-light":"source-over",t[i.SOFT_LIGHT]=r?"soft-light":"source-over",t[i.DIFFERENCE]=r?"difference":"source-over",t[i.EXCLUSION]=r?"exclusion":"source-over",t[i.HUE]=r?"hue":"source-over",t[i.SATURATION]=r?"saturation":"source-over",t[i.COLOR]=r?"color":"source-over",t[i.LUMINOSITY]=r?"luminosity":"source-over",e.blendModesCanvas=t}},e.BaseTexture=function(t,i){this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||e.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},e.BaseTexture.prototype.constructor=e.BaseTexture,e.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=!0,this.width=t,this.height=e,this.dirty()},e.BaseTexture.prototype.destroy=function(){this.source&&e.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},e.BaseTexture.prototype.updateSourceImage=function(t){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")},e.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var i=this._glTextures[t],r=e.glContexts[t];r&&i&&r.deleteTexture(i)}this._glTextures.length=0,this.dirty()},e.BaseTexture.fromCanvas=function(t,i){return 0===t.width&&(t.width=1),0===t.height&&(t.height=1),new e.BaseTexture(t,i)},e.TextureSilentFail=!1,e.Texture=function(t,i,r,o){this.noFrame=!1,i||(this.noFrame=!0,i=new e.Rectangle(0,0,1,1)),t instanceof e.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=i,this.trim=o,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||new e.Rectangle(0,0,1,1),t.hasLoaded&&(this.noFrame&&(i=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(i))},e.Texture.prototype.constructor=e.Texture,e.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame)},e.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},e.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){if(!e.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);return void(this.valid=!1)}this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/r,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/r,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/r,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/r},e.Texture.fromCanvas=function(t,i){var r=e.BaseTexture.fromCanvas(t,i);return new e.Texture(r)},e.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},e.RenderTexture=function(t,i,r,o,s){if(this.width=t||100,this.height=i||100,this.resolution=s||1,this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new e.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=o||e.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,e.Texture.call(this,this.baseTexture,new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=r||e.defaultRenderer,this.renderer.type===e.WEBGL_RENDERER){var n=this.renderer.gl;this.baseTexture._dirty[n.id]=!1,this.textureBuffer=new e.FilterTexture(n,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[n.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new e.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new e.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this.tempMatrix=new Phaser.Matrix,this._updateUvs()},e.RenderTexture.prototype=Object.create(e.Texture.prototype),e.RenderTexture.prototype.constructor=e.RenderTexture,e.RenderTexture.prototype.resize=function(t,i,r){t===this.width&&i===this.height||(this.valid=t>0&&i>0,this.width=t,this.height=i,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=i*this.resolution,r&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===e.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},e.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===e.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},e.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid&&0!==t.alpha){var r=t.worldTransform;r.identity(),r.translate(0,2*this.projection.y),e&&r.append(e),r.scale(1,-1);for(var o=0;o<t.children.length;o++)t.children[o].updateTransform();var s=this.renderer.gl;s.viewport(0,0,this.width*this.resolution,this.height*this.resolution),s.bindFramebuffer(s.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e),this.renderer.spriteBatch.dirty=!0}},e.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid&&0!==t.alpha){var r=t.worldTransform;r.identity(),e&&r.append(e);for(var o=0;o<t.children.length;o++)t.children[o].updateTransform();i&&this.textureBuffer.clear();var s=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,this.textureBuffer.context,e),this.renderer.resolution=s}},e.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,o=new Uint8Array(4*i*r);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,o),t.bindFramebuffer(t.FRAMEBUFFER,null);var s=new e.CanvasBuffer(i,r),n=s.context.getImageData(0,0,i,r);return n.data.set(o),s.context.putImageData(n,0,0),s.canvas}return this.textureBuffer.canvas},e.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},e.AbstractFilter.prototype.constructor=e.AbstractFilter,e.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},e.Strip=function(t){e.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new e.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new e.Float32Array([1,1,1,1]),this.indices=new e.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=e.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=e.Strip.DrawModes.TRIANGLE_STRIP},e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Strip.prototype.constructor=e.Strip,e.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},e.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},e.Strip.prototype._renderStrip=function(t){var i=t.gl,r=t.projection,o=t.offset,s=t.shaderManager.stripShader,n=this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),i.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(s.projectionVector,r.x,-r.y),i.uniform2f(s.offsetVector,-o.x,-o.y),i.uniform1f(s.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(s.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(s.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(s.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(s.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(n,this.indices.length,i.UNSIGNED_SHORT,0)},e.Strip.prototype._renderCanvas=function(t){var i=t.context,r=this.worldTransform,o=r.tx*t.resolution+t.shakeX,s=r.ty*t.resolution+t.shakeY;t.roundPixels?i.setTransform(r.a,r.b,r.c,r.d,0|o,0|s):i.setTransform(r.a,r.b,r.c,r.d,o,s),this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(i):this._renderCanvasTriangles(i)},e.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,r=e.length/2;this.count++;for(var o=0;o<r-2;o++){var s=2*o;this._renderCanvasDrawTriangle(t,e,i,s,s+2,s+4)}},e.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,r=this.indices,o=r.length;this.count++;for(var s=0;s<o;s+=3){var n=2*r[s],a=2*r[s+1],h=2*r[s+2];this._renderCanvasDrawTriangle(t,e,i,n,a,h)}},e.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,r,o,s){var n=this.texture.baseTexture.source,a=this.texture.width,h=this.texture.height,c=e[r],l=e[o],u=e[s],p=e[r+1],d=e[o+1],f=e[s+1],v=i[r]*a,g=i[o]*a,y=i[s]*a,m=i[r+1]*h,b=i[o+1]*h,x=i[s+1]*h;if(this.canvasPadding>0){var A=this.canvasPadding/this.worldTransform.a,E=this.canvasPadding/this.worldTransform.d,B=(c+l+u)/3,S=(p+d+f)/3,T=c-B,w=p-S,R=Math.sqrt(T*T+w*w);c=B+T/R*(R+A),p=S+w/R*(R+E),T=l-B,w=d-S,R=Math.sqrt(T*T+w*w),l=B+T/R*(R+A),d=S+w/R*(R+E),T=u-B,w=f-S,R=Math.sqrt(T*T+w*w),u=B+T/R*(R+A),f=S+w/R*(R+E)}t.save(),t.beginPath(),t.moveTo(c,p),t.lineTo(l,d),t.lineTo(u,f),t.closePath(),t.clip();var C=v*b+m*y+g*x-b*y-m*g-v*x,P=c*b+m*u+l*x-b*u-m*l-c*x,L=v*l+c*y+g*u-l*y-c*g-v*u,_=v*b*u+m*l*y+c*g*x-c*b*y-m*g*u-v*l*x,M=p*b+m*f+d*x-b*f-m*d-p*x,F=v*d+p*y+g*f-d*y-p*g-v*f,I=v*b*f+m*d*y+p*g*x-p*b*y-m*g*f-v*d*x;t.transform(P/C,M/C,L/C,F/C,_/C,I/C),t.drawImage(n,0,0),t.restore()},e.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,r=i.length/2;this.count++,e.beginPath();for(var o=1;o<r-2;o++){var s=2*o,n=i[s],a=i[s+2],h=i[s+4],c=i[s+1],l=i[s+3],u=i[s+5];e.moveTo(n,c),e.lineTo(a,l),e.lineTo(h,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},e.Strip.prototype.getBounds=function(t){for(var i=t||this.worldTransform,r=i.a,o=i.b,s=i.c,n=i.d,a=i.tx,h=i.ty,c=-(1/0),l=-(1/0),u=1/0,p=1/0,d=this.vertices,f=0,v=d.length;f<v;f+=2){var g=d[f],y=d[f+1],m=r*g+s*y+a,b=n*y+o*g+h;u=m<u?m:u,p=b<p?b:p,c=m>c?m:c,l=b>l?b:l}if(u===-(1/0)||l===1/0)return e.EmptyRectangle;var x=this._bounds;return x.x=u,x.width=c-u,x.y=p,x.height=l-p,this._currentBounds=x,x},e.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},e.Rope=function(t,i){e.Strip.call(this,t),this.points=i,this.vertices=new e.Float32Array(4*i.length),this.uvs=new e.Float32Array(4*i.length),this.colors=new e.Float32Array(2*i.length),this.indices=new e.Uint16Array(2*i.length),this.refresh()},e.Rope.prototype=Object.create(e.Strip.prototype),e.Rope.prototype.constructor=e.Rope,e.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=t[0],r=this.indices,o=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,o[0]=1,o[1]=1,r[0]=0,r[1]=1;for(var s,n,a,h=t.length,c=1;c<h;c++)s=t[c],n=4*c,a=c/(h-1),c%2?(e[n]=a,e[n+1]=0,e[n+2]=a,e[n+3]=1):(e[n]=a,e[n+1]=0,e[n+2]=a,e[n+3]=1),n=2*c,o[n]=1,o[n+1]=1,n=2*c,r[n]=n,r[n+1]=n+1,i=s}},e.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var i,r=t[0],o={x:0,y:0};this.count-=.2;for(var s,n,a,h,c,l=this.vertices,u=t.length,p=0;p<u;p++)s=t[p],n=4*p,i=p<t.length-1?t[p+1]:s,o.y=-(i.x-r.x),o.x=i.y-r.y,a=10*(1-p/(u-1)),a>1&&(a=1),h=Math.sqrt(o.x*o.x+o.y*o.y),c=this.texture.height/2,o.x/=h,o.y/=h,o.x*=c,o.y*=c,l[n]=s.x+o.x,l[n+1]=s.y+o.y,l[n+2]=s.x-o.x,l[n+3]=s.y-o.y,r=s;e.DisplayObjectContainer.prototype.updateTransform.call(this)}},e.Rope.prototype.setTexture=function(t){this.texture=t},e.TilingSprite=function(t,i,r){e.Sprite.call(this,t),this._width=i||128,this._height=r||128,this.tileScale=new e.Point(1,1),this.tileScaleOffset=new e.Point(1,1),this.tilePosition=new e.Point,this.renderable=!0,this.tint=16777215,this.textureDebug=!1,this.blendMode=e.blendModes.NORMAL,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0},e.TilingSprite.prototype=Object.create(e.Sprite.prototype),e.TilingSprite.prototype.constructor=e.TilingSprite,e.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},e.TilingSprite.prototype._renderWebGL=function(t){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,t),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},e.TilingSprite.prototype._renderCanvas=function(t){if(this.visible&&this.renderable&&0!==this.alpha){var i=t.context;this._mask&&t.maskManager.pushMask(this._mask,t),i.globalAlpha=this.worldAlpha;var r=this.worldTransform,o=t.resolution,s=r.tx*o+t.shakeX,n=r.ty*o+t.shakeY;if(i.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,s,n),this.refreshTexture){if(this.generateTilingTexture(!1,t),!this.tilingTexture)return;this.tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var a=t.currentBlendMode;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]);var h=this.tilePosition,c=this.tileScale;h.x%=this.tilingTexture.baseTexture.width,h.y%=this.tilingTexture.baseTexture.height,i.scale(c.x,c.y),i.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height),i.fillStyle=this.tilePattern;var s=-h.x,n=-h.y,l=this._width/c.x,u=this._height/c.y;t.roundPixels&&(s|=0,n|=0,l|=0,u|=0),i.fillRect(s,n,l,u),i.scale(1/c.x,1/c.y),i.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t);for(var p=0;p<this.children.length;p++)this.children[p]._renderCanvas(t);a!==this.blendMode&&(t.currentBlendMode=a,i.globalCompositeOperation=e.blendModesCanvas[a])}},e.TilingSprite.prototype.onTextureUpdate=function(){},e.TilingSprite.prototype.generateTilingTexture=function(t,i){if(this.texture.baseTexture.hasLoaded){var r=this.texture,o=r.frame,s=this._frame.sourceSizeW||this._frame.width,n=this._frame.sourceSizeH||this._frame.height,a=0,h=0;this._frame.trimmed&&(a=this._frame.spriteSourceSizeX,h=this._frame.spriteSourceSizeY),t&&(s=e.getNextPowerOfTwo(s),n=e.getNextPowerOfTwo(n)),this.canvasBuffer?(this.canvasBuffer.resize(s,n),this.tilingTexture.baseTexture.width=s,this.tilingTexture.baseTexture.height=n,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new e.CanvasBuffer(s,n),this.tilingTexture=e.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0),this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,s,n));var c=r.crop.width,l=r.crop.height;c===s&&l===n||(c=s,l=n),this.canvasBuffer.context.drawImage(r.baseTexture.source,r.crop.x,r.crop.y,r.crop.width,r.crop.height,a,h,c,l),this.tileScaleOffset.x=o.width/s,this.tileScaleOffset.y=o.height/n,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},e.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),r=t*-this.anchor.x,o=e*(1-this.anchor.y),s=e*-this.anchor.y,n=this.worldTransform,a=n.a,h=n.b,c=n.c,l=n.d,u=n.tx,p=n.ty,d=a*r+c*s+u,f=l*s+h*r+p,v=a*i+c*s+u,g=l*s+h*i+p,y=a*i+c*o+u,m=l*o+h*i+p,b=a*r+c*o+u,x=l*o+h*r+p,A=-(1/0),E=-(1/0),B=1/0,S=1/0;B=d<B?d:B,B=v<B?v:B,B=y<B?y:B,B=b<B?b:B,S=f<S?f:S,S=g<S?g:S,S=m<S?m:S,S=x<S?x:S,A=d>A?d:A,A=v>A?v:A,A=y>A?y:A,A=b>A?b:A,E=f>E?f:E,E=g>E?g:E,E=m>E?m:E,E=x>E?x:E;var T=this._bounds;return T.x=B,T.width=A-B,T.y=S,T.height=E-S,this._currentBounds=T,T},e.TilingSprite.prototype.destroy=function(){e.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.PIXI=e):"undefined"!=typeof define&&define.amd?define("PIXI",function(){return t.PIXI=e}()):t.PIXI=e,e}).call(this),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define,1){var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}else define(t)}(function(){return function t(e,i,r){function o(n,a){if(!i[n]){if(!e[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(s)return s(n,!0);throw new Error("Cannot find module '"+n+"'")}var c=i[n]={exports:{}};e[n][0].call(c.exports,function(t){var i=e[n][1][t];return o(i?i:t)},c,c.exports,t,e,i,r)}return i[n].exports}for(var s="function"==typeof require&&require,n=0;n<r.length;n++)o(r[n]);return o}({1:[function(t,e,i){function r(){}var o=t("./Scalar");e.exports=r,r.lineInt=function(t,e,i){i=i||0;var r,s,n,a,h,c,l,u=[0,0];return r=t[1][1]-t[0][1],s=t[0][0]-t[1][0],n=r*t[0][0]+s*t[0][1],a=e[1][1]-e[0][1],h=e[0][0]-e[1][0],c=a*e[0][0]+h*e[0][1],l=r*h-a*s,o.eq(l,0,i)||(u[0]=(h*n-s*c)/l,u[1]=(r*c-a*n)/l),u},r.segmentsIntersect=function(t,e,i,r){var o=e[0]-t[0],s=e[1]-t[1],n=r[0]-i[0],a=r[1]-i[1];if(n*s-a*o==0)return!1;var h=(o*(i[1]-t[1])+s*(t[0]-i[0]))/(n*s-a*o),c=(n*(t[1]-i[1])+a*(i[0]-t[0]))/(a*o-n*s);return h>=0&&h<=1&&c>=0&&c<=1}},{"./Scalar":4}],2:[function(t,e,i){function r(){}e.exports=r,r.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},r.left=function(t,e,i){return r.area(t,e,i)>0},r.leftOn=function(t,e,i){return r.area(t,e,i)>=0},r.right=function(t,e,i){return r.area(t,e,i)<0},r.rightOn=function(t,e,i){return r.area(t,e,i)<=0};var o=[],s=[];r.collinear=function(t,e,i,n){if(n){var a=o,h=s;a[0]=e[0]-t[0],a[1]=e[1]-t[1],h[0]=i[0]-e[0],h[1]=i[1]-e[1];var c=a[0]*h[0]+a[1]*h[1],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=Math.sqrt(h[0]*h[0]+h[1]*h[1]),p=Math.acos(c/(l*u));return p<n}return 0==r.area(t,e,i)},r.sqdist=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}},{}],3:[function(t,e,i){function r(){this.vertices=[]}function o(t,e,i,r,o){o=o||0;var s=e[1]-t[1],n=t[0]-e[0],h=s*t[0]+n*t[1],c=r[1]-i[1],l=i[0]-r[0],u=c*i[0]+l*i[1],p=s*l-c*n;return a.eq(p,0,o)?[0,0]:[(l*h-n*u)/p,(s*u-c*h)/p]}var s=t("./Line"),n=t("./Point"),a=t("./Scalar");e.exports=r,r.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},r.prototype.first=function(){return this.vertices[0]},r.prototype.last=function(){return this.vertices[this.vertices.length-1]},r.prototype.clear=function(){this.vertices.length=0},r.prototype.append=function(t,e,i){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var r=e;r<i;r++)this.vertices.push(t.vertices[r])},r.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);n.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},r.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},r.prototype.isReflex=function(t){return n.right(this.at(t-1),this.at(t),this.at(t+1))};var h=[],c=[];r.prototype.canSee=function(t,e){var i,r,o=h,a=c;if(n.leftOn(this.at(t+1),this.at(t),this.at(e))&&n.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;r=n.sqdist(this.at(t),this.at(e));for(var l=0;l!==this.vertices.length;++l)if((l+1)%this.vertices.length!==t&&l!==t&&n.leftOn(this.at(t),this.at(e),this.at(l+1))&&n.rightOn(this.at(t),this.at(e),this.at(l))&&(o[0]=this.at(t),o[1]=this.at(e),a[0]=this.at(l),a[1]=this.at(l+1),i=s.lineInt(o,a),n.sqdist(this.at(t),i)<r))return!1;return!0},r.prototype.copy=function(t,e,i){var o=i||new r;if(o.clear(),t<e)for(var s=t;s<=e;s++)o.vertices.push(this.vertices[s]);else{for(var s=0;s<=e;s++)o.vertices.push(this.vertices[s]);for(var s=t;s<this.vertices.length;s++)o.vertices.push(this.vertices[s])}return o},r.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],o=new r,s=Number.MAX_VALUE,n=0;n<this.vertices.length;++n)if(this.isReflex(n))for(var a=0;a<this.vertices.length;++a)if(this.canSee(n,a)){e=this.copy(n,a,o).getCutEdges(),i=this.copy(a,n,o).getCutEdges();for(var h=0;h<i.length;h++)e.push(i[h]);e.length<s&&(t=e,s=e.length,t.push([this.at(n),this.at(a)]))}return t},r.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},r.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var r=t[i],o=0;o<e.length;o++){var s=e[o],n=s.slice(r);if(n){e.splice(o,1),e.push(n[0],n[1]);break}}return e}var r=t,i=this.vertices.indexOf(r[0]),o=this.vertices.indexOf(r[1]);return i!=-1&&o!=-1&&[this.copy(i,o),this.copy(o,i)]},r.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(s.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(var e=1;e<t.length-2;e++)if(s.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},r.prototype.quickDecomp=function(t,e,i,s,a,h){a=a||100,h=h||0,s=s||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var c=[0,0],l=[0,0],u=[0,0],p=0,d=0,f=0,v=0,g=0,y=0,m=0,b=new r,x=new r,A=this,E=this.vertices;if(E.length<3)return t;if(h++,h>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var B=0;B<this.vertices.length;++B)if(A.isReflex(B)){e.push(A.vertices[B]),p=d=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S)n.left(A.at(B-1),A.at(B),A.at(S))&&n.rightOn(A.at(B-1),A.at(B),A.at(S-1))&&(u=o(A.at(B-1),A.at(B),A.at(S),A.at(S-1)),n.right(A.at(B+1),A.at(B),u)&&(f=n.sqdist(A.vertices[B],u),f<d&&(d=f,l=u,y=S))),n.left(A.at(B+1),A.at(B),A.at(S+1))&&n.rightOn(A.at(B+1),A.at(B),A.at(S))&&(u=o(A.at(B+1),A.at(B),A.at(S),A.at(S+1)),n.left(A.at(B-1),A.at(B),u)&&(f=n.sqdist(A.vertices[B],u),f<p&&(p=f,c=u,g=S)));if(y==(g+1)%this.vertices.length)u[0]=(l[0]+c[0])/2,u[1]=(l[1]+c[1])/2,i.push(u),B<g?(b.append(A,B,g+1),b.vertices.push(u),x.vertices.push(u),0!=y&&x.append(A,y,A.vertices.length),x.append(A,0,B+1)):(0!=B&&b.append(A,B,A.vertices.length),b.append(A,0,g+1),b.vertices.push(u),x.vertices.push(u),x.append(A,y,B+1));else{if(y>g&&(g+=this.vertices.length),v=Number.MAX_VALUE,g<y)return t;for(var S=y;S<=g;++S)n.leftOn(A.at(B-1),A.at(B),A.at(S))&&n.rightOn(A.at(B+1),A.at(B),A.at(S))&&(f=n.sqdist(A.at(B),A.at(S)),f<v&&(v=f,m=S%this.vertices.length));B<m?(b.append(A,B,m+1),0!=m&&x.append(A,m,E.length),x.append(A,0,B+1)):(0!=B&&b.append(A,B,E.length),b.append(A,0,m+1),x.append(A,m,B+1))}return b.vertices.length<x.vertices.length?(b.quickDecomp(t,e,i,s,a,h),x.quickDecomp(t,e,i,s,a,h)):(x.quickDecomp(t,e,i,s,a,h),b.quickDecomp(t,e,i,s,a,h)),t}return t.push(this),t},r.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)n.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function r(){}e.exports=r,r.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e,i){function r(t){this.lowerBound=o.create(),t&&t.lowerBound&&o.copy(this.lowerBound,t.lowerBound),this.upperBound=o.create(),t&&t.upperBound&&o.copy(this.upperBound,t.upperBound)}var o=t("../math/vec2");t("../utils/Utils");e.exports=r;var s=o.create();r.prototype.setFromPoints=function(t,e,i,r){var n=this.lowerBound,a=this.upperBound;"number"!=typeof i&&(i=0),0!==i?o.rotate(n,t[0],i):o.copy(n,t[0]),o.copy(a,n);for(var h=Math.cos(i),c=Math.sin(i),l=1;l<t.length;l++){var u=t[l];if(0!==i){var p=u[0],d=u[1];s[0]=h*p-c*d,s[1]=c*p+h*d,u=s}for(var f=0;f<2;f++)u[f]>a[f]&&(a[f]=u[f]),u[f]<n[f]&&(n[f]=u[f])}e&&(o.add(this.lowerBound,this.lowerBound,e),o.add(this.upperBound,this.upperBound,e)),r&&(this.lowerBound[0]-=r,this.lowerBound[1]-=r,this.upperBound[0]+=r,this.upperBound[1]+=r)},r.prototype.copy=function(t){o.copy(this.lowerBound,t.lowerBound),o.copy(this.upperBound,t.upperBound)},r.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var r=t.upperBound[e];this.upperBound[e]<r&&(this.upperBound[e]=r)}},r.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,r=t.lowerBound,o=t.upperBound;
return(r[0]<=i[0]&&i[0]<=o[0]||e[0]<=o[0]&&o[0]<=i[0])&&(r[1]<=i[1]&&i[1]<=o[1]||e[1]<=o[1]&&o[1]<=i[1])},r.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},r.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],r=(this.lowerBound[0]-t.from[0])*e,o=(this.upperBound[0]-t.from[0])*e,s=(this.lowerBound[1]-t.from[1])*i,n=(this.upperBound[1]-t.from[1])*i,a=Math.max(Math.max(Math.min(r,o),Math.min(s,n))),h=Math.min(Math.min(Math.max(r,o),Math.max(s,n)));return h<0?-1:a>h?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function r(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=r.AABB}var o=t("../math/vec2"),s=t("../objects/Body");e.exports=r,r.AABB=1,r.BOUNDING_CIRCLE=2,r.prototype.setWorld=function(t){this.world=t},r.prototype.getCollisionPairs=function(t){};var n=o.create();r.boundingRadiusCheck=function(t,e){o.sub(n,t.position,e.position);var i=o.squaredLength(n),r=t.boundingRadius+e.boundingRadius;return i<=r*r},r.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},r.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case r.BOUNDING_CIRCLE:i=r.boundingRadiusCheck(t,e);break;case r.AABB:i=r.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},r.canCollide=function(t,e){var i=s.KINEMATIC,r=s.STATIC;return(t.type!==r||e.type!==r)&&(!(t.type===i&&e.type===r||t.type===r&&e.type===i)&&((t.type!==i||e.type!==i)&&((t.sleepState!==s.SLEEPING||e.sleepState!==s.SLEEPING)&&!(t.sleepState===s.SLEEPING&&e.type===r||e.sleepState===s.SLEEPING&&t.type===r))))},r.NAIVE=1,r.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function r(){o.call(this,o.NAIVE)}var o=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var r=0,s=e.length;r!==s;r++)for(var n=e[r],a=0;a<r;a++){var h=e[a];o.canCollide(n,h)&&this.boundingVolumeCheck(n,h)&&i.push(n,h)}return i},r.prototype.aabbQuery=function(t,e,i){i=i||[];for(var r=t.bodies,o=0;o<r.length;o++){var s=r[o];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function r(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new l({size:32}),this.frictionEquationPool=new u({size:64}),this.restitution=0,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.frictionStiffness=d.DEFAULT_STIFFNESS,this.frictionRelaxation=d.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new p,this.contactSkinSize=.01}function o(t,e){n.set(t.vertices[0],.5*-e.length,-e.radius),n.set(t.vertices[1],.5*e.length,-e.radius),n.set(t.vertices[2],.5*e.length,e.radius),n.set(t.vertices[3],.5*-e.length,e.radius)}function s(t,e,i,r){for(var o=Y,s=X,c=z,l=H,u=t,p=e.vertices,d=null,f=0;f!==p.length+1;f++){var v=p[f%p.length],g=p[(f+1)%p.length];n.rotate(o,v,r),n.rotate(s,g,r),h(o,o,i),h(s,s,i),a(c,o,u),a(l,s,u);var y=n.crossLength(c,l);if(null===d&&(d=y),y*d<=0)return!1;d=y}return!0}var n=t("../math/vec2"),a=n.sub,h=n.add,c=n.dot,l=(t("../utils/Utils"),t("../utils/ContactEquationPool")),u=t("../utils/FrictionEquationPool"),p=t("../utils/TupleDictionary"),d=t("../equations/Equation"),f=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),v=t("../shapes/Convex"),g=t("../shapes/Shape"),y=(t("../objects/Body"),t("../shapes/Box"));e.exports=r;var m=n.fromValues(0,1),b=n.fromValues(0,0),x=n.fromValues(0,0),A=n.fromValues(0,0),E=n.fromValues(0,0),B=n.fromValues(0,0),S=n.fromValues(0,0),T=n.fromValues(0,0),w=n.fromValues(0,0),R=n.fromValues(0,0),C=n.fromValues(0,0),P=n.fromValues(0,0),L=n.fromValues(0,0),_=n.fromValues(0,0),M=n.fromValues(0,0),F=n.fromValues(0,0),I=n.fromValues(0,0),q=n.fromValues(0,0),U=n.fromValues(0,0),O=[],N=n.create(),D=n.create();r.prototype.bodiesOverlap=function(t,e){for(var i=N,r=D,o=0,s=t.shapes.length;o!==s;o++){var n=t.shapes[o];t.toWorldFrame(i,n.position);for(var a=0,h=e.shapes.length;a!==h;a++){var c=e.shapes[a];if(e.toWorldFrame(r,c.position),this[n.type|c.type](t,n,i,n.angle+t.angle,e,c,r,c.angle+e.angle,!0))return!0}}return!1},r.prototype.collidedLastStep=function(t,e){var i=0|t.id,r=0|e.id;return!!this.collidingBodiesLastStep.get(i,r)},r.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],r=i.bodyA.id,o=i.bodyB.id;this.collidingBodiesLastStep.set(r,o,!0)}for(var s=this.contactEquations,n=this.frictionEquations,a=0;a<s.length;a++)this.contactEquationPool.release(s[a]);for(var a=0;a<n.length;a++)this.frictionEquationPool.release(n[a]);this.contactEquations.length=this.frictionEquations.length=0},r.prototype.createContactEquation=function(t,e,i,r){var o=this.contactEquationPool.get();return o.bodyA=t,o.bodyB=e,o.shapeA=i,o.shapeB=r,o.restitution=this.restitution,o.firstImpact=!this.collidedLastStep(t,e),o.stiffness=this.stiffness,o.relaxation=this.relaxation,o.needsUpdate=!0,o.enabled=this.enabledEquations,o.offset=this.contactSkinSize,o},r.prototype.createFrictionEquation=function(t,e,i,r){var o=this.frictionEquationPool.get();return o.bodyA=t,o.bodyB=e,o.shapeA=i,o.shapeB=r,o.setSlipForce(this.slipForce),o.frictionCoefficient=this.frictionCoefficient,o.relativeVelocity=this.surfaceVelocity,o.enabled=this.enabledEquations,o.needsUpdate=!0,o.stiffness=this.frictionStiffness,o.relaxation=this.frictionRelaxation,o.contactEquations.length=0,o},r.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return n.copy(e.contactPointA,t.contactPointA),n.copy(e.contactPointB,t.contactPointB),n.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},r.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),r=e.bodyA;e.bodyB;n.set(i.contactPointA,0,0),n.set(i.contactPointB,0,0),n.set(i.t,0,0);for(var o=0;o!==t;o++)e=this.contactEquations[this.contactEquations.length-1-o],e.bodyA===r?(n.add(i.t,i.t,e.normalA),n.add(i.contactPointA,i.contactPointA,e.contactPointA),n.add(i.contactPointB,i.contactPointB,e.contactPointB)):(n.sub(i.t,i.t,e.normalA),n.add(i.contactPointA,i.contactPointA,e.contactPointB),n.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var s=1/t;return n.scale(i.contactPointA,i.contactPointA,s),n.scale(i.contactPointB,i.contactPointB,s),n.normalize(i.t,i.t),n.rotate90cw(i.t,i.t),i},r.prototype[g.LINE|g.CONVEX]=r.prototype.convexLine=function(t,e,i,r,o,s,n,a,h){return!h&&0},r.prototype[g.LINE|g.BOX]=r.prototype.lineBox=function(t,e,i,r,o,s,n,a,h){return!h&&0};var G=new y({width:1,height:1}),V=n.create();r.prototype[g.CAPSULE|g.CONVEX]=r.prototype[g.CAPSULE|g.BOX]=r.prototype.convexCapsule=function(t,e,i,r,s,a,h,c,l){var u=V;n.set(u,a.length/2,0),n.rotate(u,u,c),n.add(u,u,h);var p=this.circleConvex(s,a,u,c,t,e,i,r,l,a.radius);n.set(u,-a.length/2,0),n.rotate(u,u,c),n.add(u,u,h);var d=this.circleConvex(s,a,u,c,t,e,i,r,l,a.radius);if(l&&(p||d))return!0;var f=G;o(f,a);var v=this.convexConvex(t,e,i,r,s,f,h,c,l);return v+p+d},r.prototype[g.CAPSULE|g.LINE]=r.prototype.lineCapsule=function(t,e,i,r,o,s,n,a,h){return!h&&0};var k=n.create(),W=n.create(),j=new y({width:1,height:1});r.prototype[g.CAPSULE|g.CAPSULE]=r.prototype.capsuleCapsule=function(t,e,i,r,s,a,h,c,l){for(var u,p=k,d=W,f=0,v=0;v<2;v++){n.set(p,(0===v?-1:1)*e.length/2,0),n.rotate(p,p,r),n.add(p,p,i);for(var g=0;g<2;g++){n.set(d,(0===g?-1:1)*a.length/2,0),n.rotate(d,d,c),n.add(d,d,h),this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var y=this.circleCircle(t,e,p,r,s,a,d,c,l,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=u),l&&y)return!0;f+=y}}this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var m=j;o(m,e);var b=this.convexCapsule(t,m,i,r,s,a,h,c,l);if(this.enableFrictionReduction&&(this.enableFriction=u),l&&b)return!0;if(f+=b,this.enableFrictionReduction){var u=this.enableFriction;this.enableFriction=!1}o(m,a);var x=this.convexCapsule(s,m,h,c,t,e,i,r,l);return this.enableFrictionReduction&&(this.enableFriction=u),!(!l||!x)||(f+=x,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},r.prototype[g.LINE|g.LINE]=r.prototype.lineLine=function(t,e,i,r,o,s,n,a,h){return!h&&0},r.prototype[g.PLANE|g.LINE]=r.prototype.planeLine=function(t,e,i,r,o,s,l,u,p){var d=b,f=x,v=A,g=E,y=B,C=S,P=T,L=w,_=R,M=O,F=0;n.set(d,-s.length/2,0),n.set(f,s.length/2,0),n.rotate(v,d,u),n.rotate(g,f,u),h(v,v,l),h(g,g,l),n.copy(d,v),n.copy(f,g),a(y,f,d),n.normalize(C,y),n.rotate90cw(_,C),n.rotate(L,m,r),M[0]=d,M[1]=f;for(var I=0;I<M.length;I++){var q=M[I];a(P,q,i);var U=c(P,L);if(U<0){if(p)return!0;var N=this.createContactEquation(t,o,e,s);F++,n.copy(N.normalA,L),n.normalize(N.normalA,N.normalA),n.scale(P,L,U),a(N.contactPointA,q,P),a(N.contactPointA,N.contactPointA,t.position),a(N.contactPointB,q,l),h(N.contactPointB,N.contactPointB,l),a(N.contactPointB,N.contactPointB,o.position),this.contactEquations.push(N),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(N))}}return!p&&(this.enableFrictionReduction||F&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(F)),F)},r.prototype[g.PARTICLE|g.CAPSULE]=r.prototype.particleCapsule=function(t,e,i,r,o,s,n,a,h){return this.circleLine(t,e,i,r,o,s,n,a,h,s.radius,0)},r.prototype[g.CIRCLE|g.LINE]=r.prototype.circleLine=function(t,e,i,r,o,s,l,u,p,d,f){var d=d||0,f="undefined"!=typeof f?f:e.radius,v=b,g=x,y=A,m=E,F=B,I=S,q=T,U=w,N=R,D=C,G=P,V=L,k=_,W=M,j=O;n.set(U,-s.length/2,0),n.set(N,s.length/2,0),n.rotate(D,U,u),n.rotate(G,N,u),h(D,D,l),h(G,G,l),n.copy(U,D),n.copy(N,G),a(I,N,U),n.normalize(q,I),n.rotate90cw(F,q),a(V,i,U);var Y=c(V,F);a(m,U,l),a(k,i,l);var X=f+d;if(Math.abs(Y)<X){n.scale(v,F,Y),a(y,i,v),n.scale(g,F,c(F,k)),n.normalize(g,g),n.scale(g,g,d),h(y,y,g);var z=c(q,y),H=c(q,U),K=c(q,N);if(z>H&&z<K){if(p)return!0;var Q=this.createContactEquation(t,o,e,s);return n.scale(Q.normalA,v,-1),n.normalize(Q.normalA,Q.normalA),n.scale(Q.contactPointA,Q.normalA,f),h(Q.contactPointA,Q.contactPointA,i),a(Q.contactPointA,Q.contactPointA,t.position),a(Q.contactPointB,y,l),h(Q.contactPointB,Q.contactPointB,l),a(Q.contactPointB,Q.contactPointB,o.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}j[0]=U,j[1]=N;for(var Z=0;Z<j.length;Z++){var J=j[Z];if(a(V,J,i),n.squaredLength(V)<Math.pow(X,2)){if(p)return!0;var Q=this.createContactEquation(t,o,e,s);return n.copy(Q.normalA,V),n.normalize(Q.normalA,Q.normalA),n.scale(Q.contactPointA,Q.normalA,f),h(Q.contactPointA,Q.contactPointA,i),a(Q.contactPointA,Q.contactPointA,t.position),a(Q.contactPointB,J,l),n.scale(W,Q.normalA,-d),h(Q.contactPointB,Q.contactPointB,W),h(Q.contactPointB,Q.contactPointB,l),a(Q.contactPointB,Q.contactPointB,o.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}return 0},r.prototype[g.CIRCLE|g.CAPSULE]=r.prototype.circleCapsule=function(t,e,i,r,o,s,n,a,h){return this.circleLine(t,e,i,r,o,s,n,a,h,s.radius)},r.prototype[g.CIRCLE|g.CONVEX]=r.prototype[g.CIRCLE|g.BOX]=r.prototype.circleConvex=function(t,e,i,r,o,c,l,u,p,d){for(var d="number"==typeof d?d:e.radius,f=b,v=x,g=A,y=E,m=B,S=C,T=P,w=_,R=M,L=F,q=I,U=!1,O=Number.MAX_VALUE,N=c.vertices,D=0;D!==N.length+1;D++){var G=N[D%N.length],V=N[(D+1)%N.length];if(n.rotate(f,G,u),n.rotate(v,V,u),h(f,f,l),h(v,v,l),a(g,v,f),n.normalize(y,g),n.rotate90cw(m,y),n.scale(R,m,-e.radius),h(R,R,i),s(R,c,l,u)){n.sub(L,f,R);var k=Math.abs(n.dot(L,m));k<O&&(n.copy(q,R),O=k,n.scale(w,m,k),n.add(w,w,R),U=!0)}}if(U){if(p)return!0;var W=this.createContactEquation(t,o,e,c);return n.sub(W.normalA,q,i),n.normalize(W.normalA,W.normalA),n.scale(W.contactPointA,W.normalA,d),h(W.contactPointA,W.contactPointA,i),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,w,l),h(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,o.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}if(d>0)for(var D=0;D<N.length;D++){var j=N[D];if(n.rotate(T,j,u),h(T,T,l),a(S,T,i),n.squaredLength(S)<Math.pow(d,2)){if(p)return!0;var W=this.createContactEquation(t,o,e,c);return n.copy(W.normalA,S),n.normalize(W.normalA,W.normalA),n.scale(W.contactPointA,W.normalA,d),h(W.contactPointA,W.contactPointA,i),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,T,l),h(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,o.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}}return 0};var Y=n.create(),X=n.create(),z=n.create(),H=n.create();r.prototype[g.PARTICLE|g.CONVEX]=r.prototype[g.PARTICLE|g.BOX]=r.prototype.particleConvex=function(t,e,i,r,o,l,u,p,d){var f=b,v=x,g=A,y=E,m=B,w=S,R=T,P=C,L=_,M=q,F=U,I=Number.MAX_VALUE,O=!1,N=l.vertices;if(!s(i,l,u,p))return 0;if(d)return!0;for(var D=0;D!==N.length+1;D++){var G=N[D%N.length],V=N[(D+1)%N.length];n.rotate(f,G,p),n.rotate(v,V,p),h(f,f,u),h(v,v,u),a(g,v,f),n.normalize(y,g),n.rotate90cw(m,y),a(P,i,f);c(P,m);a(w,f,u),a(R,i,u),n.sub(M,f,i);var k=Math.abs(n.dot(M,m));k<I&&(I=k,n.scale(L,m,k),n.add(L,L,i),n.copy(F,m),O=!0)}if(O){var W=this.createContactEquation(t,o,e,l);return n.scale(W.normalA,F,-1),n.normalize(W.normalA,W.normalA),n.set(W.contactPointA,0,0),h(W.contactPointA,W.contactPointA,i),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,L,u),h(W.contactPointB,W.contactPointB,u),a(W.contactPointB,W.contactPointB,o.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}return 0},r.prototype[g.CIRCLE]=r.prototype.circleCircle=function(t,e,i,r,o,s,c,l,u,p,d){var f=b,p=p||e.radius,d=d||s.radius;a(f,i,c);var v=p+d;if(n.squaredLength(f)>Math.pow(v,2))return 0;if(u)return!0;var g=this.createContactEquation(t,o,e,s);return a(g.normalA,c,i),n.normalize(g.normalA,g.normalA),n.scale(g.contactPointA,g.normalA,p),n.scale(g.contactPointB,g.normalA,-d),h(g.contactPointA,g.contactPointA,i),a(g.contactPointA,g.contactPointA,t.position),h(g.contactPointB,g.contactPointB,c),a(g.contactPointB,g.contactPointB,o.position),this.contactEquations.push(g),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(g)),1},r.prototype[g.PLANE|g.CONVEX]=r.prototype[g.PLANE|g.BOX]=r.prototype.planeConvex=function(t,e,i,r,o,s,l,u,p){var d=b,f=x,v=A,g=0;n.rotate(f,m,r);for(var y=0;y!==s.vertices.length;y++){var E=s.vertices[y];if(n.rotate(d,E,u),h(d,d,l),a(v,d,i),c(v,f)<=0){if(p)return!0;g++;var B=this.createContactEquation(t,o,e,s);a(v,d,i),n.copy(B.normalA,f);var S=c(v,B.normalA);n.scale(v,B.normalA,S),a(B.contactPointB,d,o.position),a(B.contactPointA,d,v),a(B.contactPointA,B.contactPointA,t.position),this.contactEquations.push(B),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B))}}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},r.prototype[g.PARTICLE|g.PLANE]=r.prototype.particlePlane=function(t,e,i,r,o,s,h,l,u){var p=b,d=x;l=l||0,a(p,i,h),n.rotate(d,m,l);var f=c(p,d);if(f>0)return 0;if(u)return!0;var v=this.createContactEquation(o,t,s,e);return n.copy(v.normalA,d),n.scale(p,v.normalA,f),a(v.contactPointA,i,p),a(v.contactPointA,v.contactPointA,o.position),a(v.contactPointB,i,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},r.prototype[g.CIRCLE|g.PARTICLE]=r.prototype.circleParticle=function(t,e,i,r,o,s,c,l,u){var p=b;if(a(p,c,i),n.squaredLength(p)>Math.pow(e.radius,2))return 0;if(u)return!0;var d=this.createContactEquation(t,o,e,s);return n.copy(d.normalA,p),n.normalize(d.normalA,d.normalA),n.scale(d.contactPointA,d.normalA,e.radius),h(d.contactPointA,d.contactPointA,i),a(d.contactPointA,d.contactPointA,t.position),a(d.contactPointB,c,o.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var K=new f({radius:1}),Q=n.create(),Z=n.create();n.create();r.prototype[g.PLANE|g.CAPSULE]=r.prototype.planeCapsule=function(t,e,i,r,o,s,a,c,l){var u=Q,p=Z,d=K;n.set(u,-s.length/2,0),n.rotate(u,u,c),h(u,u,a),n.set(p,s.length/2,0),n.rotate(p,p,c),h(p,p,a),d.radius=s.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(o,d,u,0,t,e,i,r,l),g=this.circlePlane(o,d,p,0,t,e,i,r,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l)return v||g;var y=v+g;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},r.prototype[g.CIRCLE|g.PLANE]=r.prototype.circlePlane=function(t,e,i,r,o,s,l,u,p){var d=t,f=e,v=i,g=o,y=l,E=u;E=E||0;var B=b,S=x,T=A;a(B,v,y),n.rotate(S,m,E);var w=c(S,B);if(w>f.radius)return 0;if(p)return!0;var R=this.createContactEquation(g,d,s,e);return n.copy(R.normalA,S),n.scale(R.contactPointB,R.normalA,-f.radius),h(R.contactPointB,R.contactPointB,v),a(R.contactPointB,R.contactPointB,d.position),n.scale(T,R.normalA,w),a(R.contactPointA,B,T),h(R.contactPointA,R.contactPointA,y),a(R.contactPointA,R.contactPointA,g.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1},r.prototype[g.CONVEX]=r.prototype[g.CONVEX|g.BOX]=r.prototype[g.BOX]=r.prototype.convexConvex=function(t,e,i,o,s,l,u,p,d,f){var v=b,g=x,y=A,m=E,S=B,C=T,P=w,L=R,_=0,f="number"==typeof f?f:0,M=r.findSeparatingAxis(e,i,o,l,u,p,v);if(!M)return 0;a(P,u,i),c(v,P)>0&&n.scale(v,v,-1);var F=r.getClosestEdge(e,o,v,!0),I=r.getClosestEdge(l,p,v);if(F===-1||I===-1)return 0;for(var q=0;q<2;q++){var U=F,O=I,N=e,D=l,G=i,V=u,k=o,W=p,j=t,Y=s;if(0===q){var X;X=U,U=O,O=X,X=N,N=D,D=X,X=G,G=V,V=X,X=k,k=W,W=X,X=j,j=Y,Y=X}for(var z=O;z<O+2;z++){var H=D.vertices[(z+D.vertices.length)%D.vertices.length];n.rotate(g,H,W),h(g,g,V);for(var K=0,Q=U-1;Q<U+2;Q++){var Z=N.vertices[(Q+N.vertices.length)%N.vertices.length],J=N.vertices[(Q+1+N.vertices.length)%N.vertices.length];n.rotate(y,Z,k),n.rotate(m,J,k),h(y,y,G),h(m,m,G),a(S,m,y),n.rotate90cw(L,S),n.normalize(L,L),a(P,g,y);var $=c(L,P);(Q===U&&$<=f||Q!==U&&$<=0)&&K++}if(K>=3){if(d)return!0;var tt=this.createContactEquation(j,Y,N,D);_++;var Z=N.vertices[U%N.vertices.length],J=N.vertices[(U+1)%N.vertices.length];n.rotate(y,Z,k),n.rotate(m,J,k),h(y,y,G),h(m,m,G),a(S,m,y),n.rotate90cw(tt.normalA,S),n.normalize(tt.normalA,tt.normalA),a(P,g,y);var $=c(tt.normalA,P);n.scale(C,tt.normalA,$),a(tt.contactPointA,g,G),a(tt.contactPointA,tt.contactPointA,C),h(tt.contactPointA,tt.contactPointA,G),a(tt.contactPointA,tt.contactPointA,j.position),a(tt.contactPointB,g,V),h(tt.contactPointB,tt.contactPointB,V),a(tt.contactPointB,tt.contactPointB,Y.position),this.contactEquations.push(tt),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(tt))}}}return this.enableFrictionReduction&&this.enableFriction&&_&&this.frictionEquations.push(this.createFrictionFromAverage(_)),_};var J=n.fromValues(0,0);r.projectConvexOntoAxis=function(t,e,i,r,o){var s,a,h=null,l=null,u=J;n.rotate(u,r,-i);for(var p=0;p<t.vertices.length;p++)s=t.vertices[p],a=c(s,u),(null===h||a>h)&&(h=a),(null===l||a<l)&&(l=a);if(l>h){var d=l;l=h,h=d}var f=c(e,r);n.set(o,l+f,h+f)};var $=n.fromValues(0,0),tt=n.fromValues(0,0),et=n.fromValues(0,0),it=n.fromValues(0,0),rt=n.fromValues(0,0),ot=n.fromValues(0,0);r.findSeparatingAxis=function(t,e,i,o,s,h,c){var l=null,u=!1,p=!1,d=$,f=tt,v=et,g=it,m=rt,b=ot;if(t instanceof y&&o instanceof y)for(var x=0;2!==x;x++){var A=t,E=i;1===x&&(A=o,E=h);for(var B=0;2!==B;B++){0===B?n.set(g,0,1):1===B&&n.set(g,1,0),0!==E&&n.rotate(g,g,E),r.projectConvexOntoAxis(t,e,i,g,m),r.projectConvexOntoAxis(o,s,h,g,b);var S=m,T=b,w=!1;m[0]>b[0]&&(T=m,S=b,w=!0);var R=T[0]-S[1];u=R<=0,(null===l||R>l)&&(n.copy(c,g),l=R,p=u)}}else for(var x=0;2!==x;x++){var A=t,E=i;1===x&&(A=o,E=h);for(var B=0;B!==A.vertices.length;B++){n.rotate(f,A.vertices[B],E),n.rotate(v,A.vertices[(B+1)%A.vertices.length],E),a(d,v,f),n.rotate90cw(g,d),n.normalize(g,g),r.projectConvexOntoAxis(t,e,i,g,m),r.projectConvexOntoAxis(o,s,h,g,b);var S=m,T=b,w=!1;m[0]>b[0]&&(T=m,S=b,w=!0);var R=T[0]-S[1];u=R<=0,(null===l||R>l)&&(n.copy(c,g),l=R,p=u)}}return p};var st=n.fromValues(0,0),nt=n.fromValues(0,0),at=n.fromValues(0,0);r.getClosestEdge=function(t,e,i,r){var o=st,s=nt,h=at;n.rotate(o,i,-e),r&&n.scale(o,o,-1);for(var l=-1,u=t.vertices.length,p=-1,d=0;d!==u;d++){a(s,t.vertices[(d+1)%u],t.vertices[d%u]),n.rotate90cw(h,s),n.normalize(h,h);var f=c(h,o);(l===-1||f>p)&&(l=d%u,p=f)}return l};var ht=n.create(),ct=n.create(),lt=n.create(),ut=n.create(),pt=n.create(),dt=n.create(),ft=n.create();r.prototype[g.CIRCLE|g.HEIGHTFIELD]=r.prototype.circleHeightfield=function(t,e,i,r,o,s,c,l,u,p){var d=s.heights,p=p||e.radius,f=s.elementWidth,v=ct,g=ht,y=pt,m=ft,b=dt,x=lt,A=ut,E=Math.floor((i[0]-p-c[0])/f),B=Math.ceil((i[0]+p-c[0])/f);E<0&&(E=0),B>=d.length&&(B=d.length-1);for(var S=d[E],T=d[B],w=E;w<B;w++)d[w]<T&&(T=d[w]),d[w]>S&&(S=d[w]);if(i[1]-p>S)return!u&&0;for(var R=!1,w=E;w<B;w++){n.set(x,w*f,d[w]),n.set(A,(w+1)*f,d[w+1]),n.add(x,x,c),n.add(A,A,c),n.sub(b,A,x),n.rotate(b,b,Math.PI/2),n.normalize(b,b),n.scale(g,b,-p),n.add(g,g,i),n.sub(v,g,x);var C=n.dot(v,b);if(g[0]>=x[0]&&g[0]<A[0]&&C<=0){if(u)return!0;R=!0,n.scale(v,b,-C),n.add(y,g,v),n.copy(m,b);var P=this.createContactEquation(o,t,s,e);n.copy(P.normalA,m),n.scale(P.contactPointB,P.normalA,-p),h(P.contactPointB,P.contactPointB,i),a(P.contactPointB,P.contactPointB,t.position),n.copy(P.contactPointA,y),n.sub(P.contactPointA,P.contactPointA,o.position),this.contactEquations.push(P),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}}if(R=!1,p>0)for(var w=E;w<=B;w++)if(n.set(x,w*f,d[w]),n.add(x,x,c),n.sub(v,i,x),n.squaredLength(v)<Math.pow(p,2)){if(u)return!0;R=!0;var P=this.createContactEquation(o,t,s,e);n.copy(P.normalA,v),n.normalize(P.normalA,P.normalA),n.scale(P.contactPointB,P.normalA,-p),h(P.contactPointB,P.contactPointB,i),a(P.contactPointB,P.contactPointB,t.position),a(P.contactPointA,x,c),h(P.contactPointA,P.contactPointA,c),a(P.contactPointA,P.contactPointA,o.position),this.contactEquations.push(P),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}return R?1:0};var vt=n.create(),gt=n.create(),yt=n.create(),mt=new v({vertices:[n.create(),n.create(),n.create(),n.create()]});r.prototype[g.BOX|g.HEIGHTFIELD]=r.prototype[g.CONVEX|g.HEIGHTFIELD]=r.prototype.convexHeightfield=function(t,e,i,r,o,s,a,h,c){var l=s.heights,u=s.elementWidth,p=vt,d=gt,f=yt,v=mt,g=Math.floor((t.aabb.lowerBound[0]-a[0])/u),y=Math.ceil((t.aabb.upperBound[0]-a[0])/u);g<0&&(g=0),y>=l.length&&(y=l.length-1);for(var m=l[g],b=l[y],x=g;x<y;x++)l[x]<b&&(b=l[x]),l[x]>m&&(m=l[x]);if(t.aabb.lowerBound[1]>m)return!c&&0;for(var A=0,x=g;x<y;x++){n.set(p,x*u,l[x]),n.set(d,(x+1)*u,l[x+1]),n.add(p,p,a),n.add(d,d,a);var E=100;n.set(f,.5*(d[0]+p[0]),.5*(d[1]+p[1]-E)),n.sub(v.vertices[0],d,f),n.sub(v.vertices[1],p,f),n.copy(v.vertices[2],v.vertices[1]),n.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=E,v.vertices[3][1]-=E,A+=this.convexConvex(t,e,i,r,o,v,f,0,c)}return A}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function r(t){t=t||{},this.from=t.from?s.fromValues(t.from[0],t.from[1]):s.create(),this.to=t.to?s.fromValues(t.to[0],t.to[1]):s.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:r.ANY,this.callback=t.callback||function(t){},this.direction=s.create(),this.length=1,this.update()}function o(t,e,i){s.sub(a,i,t);var r=s.dot(a,e);return s.scale(h,e,r),s.add(h,h,t),s.squaredDistance(i,h)}e.exports=r;var s=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");r.prototype.constructor=r,r.CLOSEST=1,r.ANY=2,r.ALL=4,r.prototype.update=function(){var t=this.direction;s.sub(t,this.to,this.from),this.length=s.length(t),s.normalize(t,t)},r.prototype.intersectBodies=function(t,e){for(var i=0,r=e.length;!t.shouldStop(this)&&i<r;i++){var o=e[i],s=o.getAABB();(s.overlapsRay(this)>=0||s.containsPoint(this.from))&&this.intersectBody(t,o)}};var n=s.create();r.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var r=n,o=0,a=e.shapes.length;o<a;o++){var h=e.shapes[o];if((!i||h.collisionResponse)&&0!==(this.collisionGroup&h.collisionMask)&&0!==(h.collisionGroup&this.collisionMask)){s.rotate(r,h.position,e.angle),s.add(r,r,e.position);var c=h.angle+e.angle;if(this.intersectShape(t,h,c,r,e),t.shouldStop(this))break}}},r.prototype.intersectShape=function(t,e,i,r,s){var n=this.from,a=o(n,this.direction,r);a>e.boundingRadius*e.boundingRadius||(this._currentBody=s,this._currentShape=e,e.raycast(t,this,r,i),this._currentBody=this._currentShape=null)},r.prototype.getAABB=function(t){var e=this.to,i=this.from;s.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),s.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};s.create();r.prototype.reportIntersection=function(t,e,i,o){var n=(this.from,this.to,this._currentShape),a=this._currentBody;if(!(this.skipBackfaces&&s.dot(i,this.direction)>0))switch(this.mode){case r.ALL:t.set(i,n,a,e,o),this.callback(t);break;case r.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,n,a,e,o);break;case r.ANY:t.set(i,n,a,e,o)}};var a=s.create(),h=s.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function r(){this.normal=o.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var o=t("../math/vec2"),s=t("../collision/Ray");e.exports=r,r.prototype.reset=function(){o.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},r.prototype.getHitDistance=function(t){return o.distance(t.from,t.to)*this.fraction},r.prototype.hasHit=function(){return this.fraction!==-1},r.prototype.getHitPoint=function(t,e){o.lerp(t,e.from,e.to,this.fraction)},r.prototype.stop=function(){this.isStopped=!0},r.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===s.ANY},r.prototype.set=function(t,e,i,r,s){o.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=r,this.faceIndex=s}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function r(){s.call(this,s.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);i!==-1&&t.axisList.splice(i,1)}}var o=t("../utils/Utils"),s=t("../collision/Broadphase");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.setWorld=function(t){this.axisList.length=0,o.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},r.sortAxisList=function(t,e){e=0|e;for(var i=1,r=t.length;i<r;i++){for(var o=t[i],s=i-1;s>=0&&!(t[s].aabb.lowerBound[e]<=o.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=o}return t},r.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;r.sortAxisList(t,e)},r.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,r=this.axisIndex;i.length=0;for(var o=e.length;o--;){var n=e[o];n.aabbNeedsUpdate&&n.updateAABB()}this.sortList();for(var a=0,h=0|e.length;a!==h;a++)for(var c=e[a],l=a+1;l<h;l++){var u=e[l],p=u.aabb.lowerBound[r]<=c.aabb.upperBound[r];if(!p)break;s.canCollide(c,u)&&this.boundingVolumeCheck(c,u)&&i.push(c,u)}return i},r.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var r=this.axisIndex,o="x";1===r&&(o="y"),2===r&&(o="z");for(var s=this.axisList,n=(e.lowerBound[o],e.upperBound[o],0);n<s.length;n++){var a=s[n];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&i.push(a)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function r(t,e,i,r){this.type=i,r=o.defaults(r,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=r.collideConnected,r.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=r;var o=t("../utils/Utils");r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.DISTANCE=1,r.GEAR=2,r.LOCK=3,r.PRISMATIC=4,r.REVOLUTE=5,r.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var r=e[i];r.stiffness=t,r.needsUpdate=!0}},r.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var r=e[i];r.relaxation=t,r.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function r(t,e,i){i=a.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),o.call(this,t,e,o.DISTANCE,i),this.localAnchorA=n.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=n.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var r=this.localAnchorA,h=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var c=n.create(),l=n.create(),u=n.create();n.rotate(c,r,t.angle),n.rotate(l,h,e.angle),n.add(u,e.position,l),n.sub(u,u,c),n.sub(u,u,t.position),this.distance=n.length(u)}var p;p="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce;var d=new s(t,e,(-p),p);this.equations=[d],this.maxForce=p;var u=n.create(),f=n.create(),v=n.create(),g=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,o=e.position;return n.rotate(f,r,t.angle),n.rotate(v,h,e.angle),n.add(u,o,v),n.sub(u,u,f),n.sub(u,u,i),n.length(u)-g.distance},this.setMaxForce(p),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var o=t("./Constraint"),s=t("../equations/Equation"),n=t("../math/vec2"),a=t("../utils/Utils");e.exports=r,r.prototype=new o,r.prototype.constructor=r;var h=n.create(),c=n.create(),l=n.create();r.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,r=(this.distance,e.position),o=i.position,s=this.equations[0],a=t.G;n.rotate(c,this.localAnchorA,e.angle),n.rotate(l,this.localAnchorB,i.angle),n.add(h,o,l),n.sub(h,h,c),n.sub(h,h,r),this.position=n.length(h);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,
u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u)return void(s.enabled=!1);s.enabled=!0,n.normalize(h,h);var p=n.crossLength(c,h),d=n.crossLength(l,h);a[0]=-h[0],a[1]=-h[1],a[2]=-p,a[3]=h[0],a[4]=h[1],a[5]=d},r.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},r.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,o.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new s(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var o=t("./Constraint"),s=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},r.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},r.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,o.LOCK,i);var r="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce,a=(i.localAngleB||0,new n(t,e,(-r),r)),h=new n(t,e,(-r),r),c=new n(t,e,(-r),r),l=s.create(),u=s.create(),p=this;a.computeGq=function(){return s.rotate(l,p.localOffsetB,t.angle),s.sub(u,e.position,t.position),s.sub(u,u,l),u[0]},h.computeGq=function(){return s.rotate(l,p.localOffsetB,t.angle),s.sub(u,e.position,t.position),s.sub(u,u,l),u[1]};var d=s.create(),f=s.create();c.computeGq=function(){return s.rotate(d,p.localOffsetB,e.angle-p.localAngleB),s.scale(d,d,-1),s.sub(u,t.position,e.position),s.add(u,u,d),s.rotate(f,d,-Math.PI/2),s.normalize(f,f),s.dot(u,f)},this.localOffsetB=s.create(),i.localOffsetB?s.copy(this.localOffsetB,i.localOffsetB):(s.sub(this.localOffsetB,e.position,t.position),s.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(a,h,c),this.setMaxForce(r)}var o=t("./Constraint"),s=t("../math/vec2"),n=t("../equations/Equation");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},r.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=s.create(),h=s.create(),c=s.create(),l=s.fromValues(1,0),u=s.fromValues(0,1);r.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],r=this.bodyA,o=this.bodyB;s.rotate(a,this.localOffsetB,r.angle),s.rotate(h,this.localOffsetB,o.angle-this.localAngleB),s.scale(h,h,-1),s.rotate(c,h,Math.PI/2),s.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-s.crossLength(a,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-s.crossLength(a,u),e.G[4]=1,i.G[0]=-c[0],i.G[1]=-c[1],i.G[3]=c[0],i.G[4]=c[1],i.G[5]=s.crossLength(h,c)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,o.PRISMATIC,i);var r=a.fromValues(0,0),c=a.fromValues(1,0),l=a.fromValues(0,0);i.localAnchorA&&a.copy(r,i.localAnchorA),i.localAxisA&&a.copy(c,i.localAxisA),i.localAnchorB&&a.copy(l,i.localAnchorB),this.localAnchorA=r,this.localAnchorB=l,this.localAxisA=c;var u=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE,p=new n(t,e,(-u),u),d=new a.create,f=new a.create,v=new a.create,g=new a.create;if(p.computeGq=function(){return a.dot(v,g)},p.updateJacobian=function(){var i=this.G,o=t.position,s=e.position;a.rotate(d,r,t.angle),a.rotate(f,l,e.angle),a.add(v,s,f),a.sub(v,v,o),a.sub(v,v,d),a.rotate(g,c,t.angle+Math.PI/2),i[0]=-g[0],i[1]=-g[1],i[2]=-a.crossLength(d,g)+a.crossLength(g,v),i[3]=g[0],i[4]=g[1],i[5]=a.crossLength(f,g)},this.equations.push(p),!i.disableRotationalLock){var y=new h(t,e,(-u),u);this.equations.push(y)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof i.lowerLimit,this.upperLimitEnabled="undefined"!=typeof i.upperLimit,this.lowerLimit="undefined"!=typeof i.lowerLimit?i.lowerLimit:0,this.upperLimit="undefined"!=typeof i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new s(t,e),this.lowerLimitEquation=new s(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new n(t,e),this.motorEnabled=!1,this.motorSpeed=0;var m=this,b=this.motorEquation;b.computeGW;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.velocity,o=i.velocity,s=e.angularVelocity,n=i.angularVelocity;return this.gmult(t,r,s,o,n)+m.motorSpeed}}var o=t("./Constraint"),s=t("../equations/ContactEquation"),n=t("../equations/Equation"),a=t("../math/vec2"),h=t("../equations/RotationalLockEquation");e.exports=r,r.prototype=new o,r.prototype.constructor=r;var c=a.create(),l=a.create(),u=a.create(),p=a.create(),d=a.create(),f=a.create();r.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,r=this.lowerLimit,o=this.upperLimitEquation,s=this.lowerLimitEquation,n=this.bodyA,h=this.bodyB,v=this.localAxisA,g=this.localAnchorA,y=this.localAnchorB;e.updateJacobian(),a.rotate(c,v,n.angle),a.rotate(p,g,n.angle),a.add(l,p,n.position),a.rotate(d,y,h.angle),a.add(u,d,h.position);var m=this.position=a.dot(u,c)-a.dot(l,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=a.crossLength(c,d),b[3]=-c[0],b[4]=-c[1],b[5]=-a.crossLength(c,p)}if(this.upperLimitEnabled&&m>i)a.scale(o.normalA,c,-1),a.sub(o.contactPointA,l,n.position),a.sub(o.contactPointB,u,h.position),a.scale(f,c,i),a.add(o.contactPointA,o.contactPointA,f),t.indexOf(o)===-1&&t.push(o);else{var x=t.indexOf(o);x!==-1&&t.splice(x,1)}if(this.lowerLimitEnabled&&m<r)a.scale(s.normalA,c,1),a.sub(s.contactPointA,l,n.position),a.sub(s.contactPointB,u,h.position),a.scale(f,c,r),a.sub(s.contactPointB,s.contactPointB,f),t.indexOf(s)===-1&&t.push(s);else{var x=t.indexOf(s);x!==-1&&t.splice(x,1)}},r.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},r.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},r.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,o.REVOLUTE,i);var r=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=h.create(),this.pivotB=h.create(),i.worldPivot?(h.sub(this.pivotA,i.worldPivot,t.position),h.sub(this.pivotB,i.worldPivot,e.position),h.rotate(this.pivotA,this.pivotA,-t.angle),h.rotate(this.pivotB,this.pivotB,-e.angle)):(h.copy(this.pivotA,i.localPivotA),h.copy(this.pivotB,i.localPivotB));var f=this.equations=[new s(t,e,(-r),r),new s(t,e,(-r),r)],v=f[0],g=f[1],y=this;v.computeGq=function(){return h.rotate(c,y.pivotA,t.angle),h.rotate(l,y.pivotB,e.angle),h.add(d,e.position,l),h.sub(d,d,t.position),h.sub(d,d,c),h.dot(d,u)},g.computeGq=function(){return h.rotate(c,y.pivotA,t.angle),h.rotate(l,y.pivotB,e.angle),h.add(d,e.position,l),h.sub(d,d,t.position),h.sub(d,d,c),h.dot(d,p)},g.minForce=v.minForce=-r,g.maxForce=v.maxForce=r,this.motorEquation=new n(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var o=t("./Constraint"),s=t("../equations/Equation"),n=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),h=t("../math/vec2");e.exports=r;var c=h.create(),l=h.create(),u=h.fromValues(1,0),p=h.fromValues(0,1),d=h.create();r.prototype=new o,r.prototype.constructor=r,r.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},r.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,r=this.pivotB,o=this.equations,s=(o[0],o[1],o[0]),n=o[1],a=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,v=this.lowerLimitEquation,g=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&g>a)f.angle=a,o.indexOf(f)===-1&&o.push(f);else{var y=o.indexOf(f);y!==-1&&o.splice(y,1)}if(this.lowerLimitEnabled&&g<d)v.angle=d,o.indexOf(v)===-1&&o.push(v);else{var y=o.indexOf(v);y!==-1&&o.splice(y,1)}h.rotate(c,i,t.angle),h.rotate(l,r,e.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-h.crossLength(c,u),s.G[3]=1,s.G[4]=0,s.G[5]=h.crossLength(l,u),n.G[0]=0,n.G[1]=-1,n.G[2]=-h.crossLength(c,p),n.G[3]=0,n.G[4]=1,n.G[5]=h.crossLength(l,p)},r.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},r.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},r.prototype.motorIsEnabled=function(){return!!this.motorEnabled},r.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},r.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var o=t("./Equation");t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},r.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},r.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function r(t,e){o.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=s.create(),this.penetrationVec=s.create(),this.contactPointB=s.create(),this.normalA=s.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var o=t("./Equation"),s=t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeB=function(t,e,i){var r=this.bodyA,o=this.bodyB,n=this.contactPointA,a=this.contactPointB,h=r.position,c=o.position,l=this.penetrationVec,u=this.normalA,p=this.G,d=s.crossLength(n,u),f=s.crossLength(a,u);p[0]=-u[0],p[1]=-u[1],p[2]=-d,p[3]=u[0],p[4]=u[1],p[5]=f,s.add(l,c,a),s.sub(l,l,h),s.sub(l,l,n);var v,g;this.firstImpact&&0!==this.restitution?(g=0,v=1/e*(1+this.restitution)*this.computeGW()):(g=s.dot(u,l)+this.offset,v=this.computeGW());var y=this.computeGiMf(),m=-g*t-v*e-i*y;return m}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function r(t,e,i,o){this.minForce="undefined"==typeof i?-Number.MAX_VALUE:i,this.maxForce="undefined"==typeof o?Number.MAX_VALUE:o,this.bodyA=t,this.bodyB=e,this.stiffness=r.DEFAULT_STIFFNESS,this.relaxation=r.DEFAULT_RELAXATION,this.G=new s.ARRAY_TYPE(6);for(var n=0;n<6;n++)this.G[n]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=r;var o=t("../math/vec2"),s=t("../utils/Utils");t("../objects/Body");r.prototype.constructor=r,r.DEFAULT_STIFFNESS=1e6,r.DEFAULT_RELAXATION=4,r.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},r.prototype.gmult=function(t,e,i,r,o){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*r[0]+t[4]*r[1]+t[5]*o},r.prototype.computeB=function(t,e,i){var r=this.computeGW(),o=this.computeGq(),s=this.computeGiMf();return-o*t-r*e-s*i};var n=o.create(),a=o.create();r.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=(e.position,i.position,e.angle),o=i.angle;return this.gmult(t,n,r,a,o)+this.offset},r.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.velocity,o=i.velocity,s=e.angularVelocity,n=i.angularVelocity;return this.gmult(t,r,s,o,n)+this.relativeVelocity},r.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.vlambda,o=i.vlambda,s=e.wlambda,n=i.wlambda;return this.gmult(t,r,s,o,n)};var h=o.create(),c=o.create();r.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,r=t.angularForce,s=e.force,n=e.angularForce,a=t.invMassSolve,l=e.invMassSolve,u=t.invInertiaSolve,p=e.invInertiaSolve,d=this.G;return o.scale(h,i,a),o.multiply(h,t.massMultiplier,h),o.scale(c,s,l),o.multiply(c,e.massMultiplier,c),this.gmult(d,h,r*u,c,n*p)},r.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,r=e.invMassSolve,o=t.invInertiaSolve,s=e.invInertiaSolve,n=this.G;return n[0]*n[0]*i*t.massMultiplier[0]+n[1]*n[1]*i*t.massMultiplier[1]+n[2]*n[2]*o+n[3]*n[3]*r*e.massMultiplier[0]+n[4]*n[4]*r*e.massMultiplier[1]+n[5]*n[5]*s};var l=o.create(),u=o.create(),p=o.create();o.create(),o.create(),o.create();r.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,r=l,s=u,n=p,a=e.invMassSolve,h=i.invMassSolve,c=e.invInertiaSolve,d=i.invInertiaSolve,f=this.G;s[0]=f[0],s[1]=f[1],n[0]=f[3],n[1]=f[4],o.scale(r,s,a*t),o.multiply(r,r,e.massMultiplier),o.add(e.vlambda,e.vlambda,r),e.wlambda+=c*f[2]*t,o.scale(r,n,h*t),o.multiply(r,r,i.massMultiplier),o.add(i.vlambda,i.vlambda,r),i.wlambda+=d*f[5]*t},r.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function r(t,e,i){s.call(this,t,e,-i,i),this.contactPointA=o.create(),this.contactPointB=o.create(),this.t=o.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var o=t("../math/vec2"),s=t("./Equation");t("../utils/Utils");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},r.prototype.getSlipForce=function(){return this.maxForce},r.prototype.computeB=function(t,e,i){var r=(this.bodyA,this.bodyB,this.contactPointA),s=this.contactPointB,n=this.t,a=this.G;a[0]=-n[0],a[1]=-n[1],a[2]=-o.crossLength(r,n),a[3]=n[0],a[4]=n[1],a[5]=o.crossLength(s,n);var h=this.computeGW(),c=this.computeGiMf(),l=-h*e-i*c;return l}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var r=this.G;r[2]=1,r[5]=-1}var o=t("./Equation"),s=t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r;var n=s.create(),a=s.create(),h=s.fromValues(1,0),c=s.fromValues(0,1);r.prototype.computeGq=function(){return s.rotate(n,h,this.bodyA.angle+this.angle),s.rotate(a,c,this.bodyB.angle),s.dot(n,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function r(t,e){o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var o=t("./Equation");t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeB=function(t,e,i){var r=this.G;r[2]=-1,r[5]=this.ratio;var o=this.computeGiMf(),s=this.computeGW(),n=-s*e-i*o;return n}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var r=function(){};e.exports=r,r.prototype={constructor:r,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),r[t].indexOf(e)===-1&&r[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&i[t].indexOf(e)!==-1)return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,r=i[t].indexOf(e);return r!==-1&&i[t].splice(r,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var r=0,o=i.length;r<o;r++){var s=i[r];s.call(s.context,t)}}return this}}},{}],27:[function(t,e,i){function r(t,e,i){if(i=i||{},!(t instanceof o&&e instanceof o))throw new Error("First two arguments must be Material instances.");this.id=r.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof i.friction?Number(i.friction):.3,this.restitution="undefined"!=typeof i.restitution?Number(i.restitution):0,this.stiffness="undefined"!=typeof i.stiffness?Number(i.stiffness):s.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof i.relaxation?Number(i.relaxation):s.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof i.frictionStiffness?Number(i.frictionStiffness):s.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof i.frictionRelaxation?Number(i.frictionRelaxation):s.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var o=t("./Material"),s=t("../equations/Equation");e.exports=r,r.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function r(t){this.id=t||r.idCounter++}e.exports=r,r.idCounter=0},{}],29:[function(t,e,i){var r={};r.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,r=0;r<e;r+=2)i+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return i+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-i},r.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],o=[],s=0;s<e;s++)o.push(s);for(var s=0,n=e;n>3;){var a=o[(s+0)%n],h=o[(s+1)%n],c=o[(s+2)%n],l=t[2*a],u=t[2*a+1],p=t[2*h],d=t[2*h+1],f=t[2*c],v=t[2*c+1],g=!1;if(r._convex(l,u,p,d,f,v)){g=!0;for(var y=0;y<n;y++){var m=o[y];if(m!=a&&m!=h&&m!=c&&r._PointInTriangle(t[2*m],t[2*m+1],l,u,p,d,f,v)){g=!1;break}}}if(g)i.push(a,h,c),o.splice((s+1)%n,1),n--,s=0;else if(s++>3*n)break}return i.push(o[0],o[1],o[2]),i},r._PointInTriangle=function(t,e,i,r,o,s,n,a){var h=n-i,c=a-r,l=o-i,u=s-r,p=t-i,d=e-r,f=h*h+c*c,v=h*l+c*u,g=h*p+c*d,y=l*l+u*u,m=l*p+u*d,b=1/(f*y-v*v),x=(y*g-v*m)*b,A=(f*m-v*g)*b;return x>=0&&A>=0&&x+A<1},r._convex=function(t,e,i,r,o,s){return(e-r)*(o-i)+(i-t)*(s-r)>=0},e.exports=r},{}],30:[function(t,e,i){var r=e.exports={},o=t("../utils/Utils");r.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},r.crossVZ=function(t,e,i){return r.rotate(t,e,-Math.PI/2),r.scale(t,t,i),t},r.crossZV=function(t,e,i){return r.rotate(t,i,Math.PI/2),r.scale(t,t,e),t},r.rotate=function(t,e,i){if(0!==i){var r=Math.cos(i),o=Math.sin(i),s=e[0],n=e[1];t[0]=r*s-o*n,t[1]=o*s+r*n}else t[0]=e[0],t[1]=e[1]},r.rotate90cw=function(t,e){var i=e[0],r=e[1];t[0]=r,t[1]=-i},r.toLocalFrame=function(t,e,i,o){r.copy(t,e),r.sub(t,t,i),r.rotate(t,t,-o)},r.toGlobalFrame=function(t,e,i,o){r.copy(t,e),r.rotate(t,t,o),r.add(t,t,i)},r.vectorToLocalFrame=function(t,e,i){r.rotate(t,e,-i)},r.vectorToGlobalFrame=function(t,e,i){r.rotate(t,e,i)},r.centroid=function(t,e,i,o){return r.add(t,e,i),r.add(t,t,o),r.scale(t,t,1/3),t},r.create=function(){var t=new o.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var i=new o.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,i){return t[0]=e,t[1]=i,t},r.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},r.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},r.sub=r.subtract,r.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},r.mul=r.multiply,r.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},r.div=r.divide,r.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},r.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},r.dist=r.distance,r.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.normalize=function(t,e){var i=e[0],r=e[1],o=i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.lerp=function(t,e,i,r){var o=e[0],s=e[1];return t[0]=o+r*(i[0]-o),t[1]=s+r*(i[1]-s),t},r.reflect=function(t,e,i){var r=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*r,t[1]=e[1]-2*i[1]*r},r.getLineSegmentsIntersection=function(t,e,i,o,s){var n=r.getLineSegmentsIntersectionFraction(e,i,o,s);return!(n<0)&&(t[0]=e[0]+n*(i[0]-e[0]),t[1]=e[1]+n*(i[1]-e[1]),!0)},r.getLineSegmentsIntersectionFraction=function(t,e,i,r){var o,s,n=e[0]-t[0],a=e[1]-t[1],h=r[0]-i[0],c=r[1]-i[1];return o=(-a*(t[0]-i[0])+n*(t[1]-i[1]))/(-h*a+n*c),s=(h*(t[1]-i[1])-c*(t[0]-i[0]))/(-h*a+n*c),o>=0&&o<=1&&s>=0&&s<=1?s:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function r(t){t=t||{},l.call(this),this.id=t.id||++r._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=o.create(),this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.interpolatedPosition=o.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=o.fromValues(0,0),this.previousAngle=0,this.velocity=o.fromValues(0,0),t.velocity&&o.copy(this.velocity,t.velocity),this.vlambda=o.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=o.create(),t.force&&o.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=r.STATIC,"undefined"!=typeof t.type?this.type=t.type:t.mass?this.type=r.DYNAMIC:this.type=r.STATIC,this.boundingRadius=0,this.aabb=new c,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=r.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var o=t("../math/vec2"),s=t("poly-decomp"),n=t("../shapes/Convex"),a=t("../collision/RaycastResult"),h=t("../collision/Ray"),c=t("../collision/AABB"),l=t("../events/EventEmitter");e.exports=r,r.prototype=new l,r.prototype.constructor=r,r._idCounter=0,r.prototype.updateSolveMassProperties=function(){this.sleepState===r.SLEEPING||this.type===r.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},r.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},r.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},r.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var u=new c,p=o.create();r.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=p,r=this.angle,s=0;s!==e;s++){var n=t[s],a=n.angle+r;o.rotate(i,n.position,r),o.add(i,i,this.position),n.computeAABB(u,i,a),0===s?this.aabb.copy(u):this.aabb.extend(u)}this.aabbNeedsUpdate=!1},r.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,r=0;r!==e;r++){var s=t[r],n=o.length(s.position),a=s.boundingRadius;n+a>i&&(i=n+a)}this.boundingRadius=i},r.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?o.copy(t.position,e):o.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},r.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return e!==-1&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},r.prototype.updateMassProperties=function(){if(this.type===r.STATIC||this.type===r.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,s=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var n=0;n<e;n++){var a=t[n],h=o.squaredLength(a.position),c=a.computeMomentOfInertia(i);s+=c+i*h}this.inertia=s,this.invInertia=s>0?1/s:0}this.invMass=1/this.mass,o.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};o.create();r.prototype.applyForce=function(t,e){if(o.add(this.force,this.force,t),e){var i=o.crossLength(e,t);this.angularForce+=i}};var d=o.create(),f=o.create(),v=o.create();r.prototype.applyForceLocal=function(t,e){e=e||v;var i=d,r=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(r,e),this.applyForce(i,r)};var g=o.create();r.prototype.applyImpulse=function(t,e){if(this.type===r.DYNAMIC){var i=g;if(o.scale(i,t,this.invMass),o.multiply(i,this.massMultiplier,i),o.add(this.velocity,i,this.velocity),e){var s=o.crossLength(e,t);s*=this.invInertia,this.angularVelocity+=s}}};var y=o.create(),m=o.create(),b=o.create();r.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=y,r=m;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(r,e),this.applyImpulse(i,r)},r.prototype.toLocalFrame=function(t,e){o.toLocalFrame(t,e,this.position,this.angle)},r.prototype.toWorldFrame=function(t,e){o.toGlobalFrame(t,e,this.position,this.angle)},r.prototype.vectorToLocalFrame=function(t,e){o.vectorToLocalFrame(t,e,this.angle)},r.prototype.vectorToWorldFrame=function(t,e){o.vectorToGlobalFrame(t,e,this.angle)},r.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var r=new s.Polygon;if(r.vertices=t,r.makeCCW(),"number"==typeof e.removeCollinearPoints&&r.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!r.isSimple())return!1;this.concavePath=r.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var a=[0,0];o.copy(a,this.concavePath[i]),this.concavePath[i]=a}var h;h=e.optimalDecomp?r.decomp():r.quickDecomp();for(var c=o.create(),i=0;i!==h.length;i++){for(var l=new n({vertices:h[i].vertices}),u=0;u!==l.vertices.length;u++){var a=l.vertices[u];o.sub(a,a,l.centerOfMass)}o.scale(c,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,c)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var x=(o.fromValues(0,0),o.fromValues(0,0)),A=o.fromValues(0,0),E=o.fromValues(0,0);r.prototype.adjustCenterOfMass=function(){var t=x,e=A,i=E,r=0;o.set(e,0,0);for(var s=0;s!==this.shapes.length;s++){var n=this.shapes[s];o.scale(t,n.position,n.area),o.add(e,e,t),r+=n.area}o.scale(i,e,1/r);for(var s=0;s!==this.shapes.length;s++){var n=this.shapes[s];o.sub(n.position,n.position,i)}o.add(this.position,this.position,i);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)o.sub(this.concavePath[s],this.concavePath[s],i);this.updateMassProperties(),this.updateBoundingRadius()},r.prototype.setZeroForce=function(){o.set(this.force,0,0),this.angularForce=0},r.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;o.set(e,0,0),t.wlambda=0},r.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;o.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},r.prototype.applyDamping=function(t){if(this.type===r.DYNAMIC){var e=this.velocity;o.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},r.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=r.AWAKE,this.idleTime=0,t!==r.AWAKE&&this.emit(r.wakeUpEvent)},r.prototype.sleep=function(){this.sleepState=r.SLEEPING,this.angularVelocity=0,this.angularForce=0,o.set(this.velocity,0,0),o.set(this.force,0,0),this.emit(r.sleepEvent)},r.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==r.SLEEPING){this.wantsToSleep=!1;var s=(this.sleepState,o.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),n=Math.pow(this.sleepSpeedLimit,2);s>=n?(this.idleTime=0,this.sleepState=r.AWAKE):(this.idleTime+=i,this.sleepState=r.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},r.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var B=o.create(),S=o.create();r.prototype.integrate=function(t){var e=this.invMass,i=this.force,r=this.position,s=this.velocity;o.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),o.scale(B,i,t*e),o.multiply(B,this.massMultiplier,B),o.add(s,B,s),this.integrateToTimeOfImpact(t)||(o.scale(S,s,t),o.add(r,r,S),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var T=new a,w=new h({mode:h.ALL}),R=o.create(),C=o.create(),P=o.create(),L=o.create();r.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||o.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;o.normalize(R,this.velocity),o.scale(C,this.velocity,t),o.add(C,C,this.position),o.sub(P,C,this.position);var e,i=this.angularVelocity*t,r=o.length(P),s=1,n=this;if(T.reset(),w.callback=function(t){t.body!==n&&(e=t.body,t.getHitPoint(C,w),o.sub(P,C,n.position),s=o.length(P)/r,t.stop())},o.copy(w.from,this.position),o.copy(w.to,C),w.update(),this.world.raycast(T,w),!e)return!1;var a=this.angle;o.copy(L,this.position);for(var h=0,c=0,l=0,u=s;u>=c&&h<this.ccdIterations;){h++,l=(u-c)/2,o.scale(S,P,s),o.add(this.position,L,S),this.angle=a+i*s,this.updateAABB();var p=this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e);p?c=l:u=l}return s=l,o.copy(this.position,L),this.angle=a,o.scale(S,P,s),o.add(this.position,this.position,S),this.fixedRotation||(this.angle+=i*s),!0},r.prototype.getVelocityAtPoint=function(t,e){return o.crossVZ(t,e,this.angularVelocity),o.subtract(t,this.velocity,t),t},r.sleepyEvent={type:"sleepy"},r.sleepEvent={type:"sleep"},r.wakeUpEvent={type:"wakeup"},r.DYNAMIC=1,r.STATIC=2,r.KINEMATIC=4,r.AWAKE=0,r.SLEEPY=1,r.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function r(t,e,i){i=i||{},s.call(this,t,e,i),this.localAnchorA=o.fromValues(0,0),this.localAnchorB=o.fromValues(0,0),i.localAnchorA&&o.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&o.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var r=o.create(),n=o.create();this.getWorldAnchorA(r),this.getWorldAnchorB(n);var a=o.distance(r,n);this.restLength="number"==typeof i.restLength?i.restLength:a}var o=t("../math/vec2"),s=t("./Spring");
t("../utils/Utils");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},r.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},r.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},r.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var n=o.create(),a=o.create(),h=o.create(),c=o.create(),l=o.create(),u=o.create(),p=o.create(),d=o.create(),f=o.create();r.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,r=this.bodyA,s=this.bodyB,v=n,g=a,y=h,m=c,b=f,x=l,A=u,E=p,B=d;this.getWorldAnchorA(x),this.getWorldAnchorB(A),o.sub(E,x,r.position),o.sub(B,A,s.position),o.sub(v,A,x);var S=o.len(v);o.normalize(g,v),o.sub(y,s.velocity,r.velocity),o.crossZV(b,s.angularVelocity,B),o.add(y,y,b),o.crossZV(b,r.angularVelocity,E),o.sub(y,y,b),o.scale(m,g,-t*(S-i)-e*o.dot(y,g)),o.sub(r.force,r.force,m),o.add(s.force,s.force,m);var T=o.crossLength(E,m),w=o.crossLength(B,m);r.angularForce-=T,s.angularForce+=w}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function r(t,e,i){i=i||{},o.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}var o=(t("../math/vec2"),t("./Spring"));e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,r=this.bodyA,o=this.bodyB,s=o.angle-r.angle,n=o.angularVelocity-r.angularVelocity,a=-t*(s-i)-e*n*0;r.angularForce-=a,o.angularForce+=a}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function r(t,e,i){i=o.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}var o=(t("../math/vec2"),t("../utils/Utils"));e.exports=r,r.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function r(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new h({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function o(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=s.fromValues(0,1),e.localForwardVector&&s.copy(this.localForwardVector,e.localForwardVector),this.localPosition=s.fromValues(0,0),e.localPosition&&s.copy(this.localPosition,e.localPosition),n.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var s=t("../math/vec2"),n=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),h=t("../objects/Body");e.exports=r,r.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},r.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},r.prototype.addWheel=function(t){var e=new o(this,t);return this.wheels.push(e),e},r.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},o.prototype=new n,o.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},o.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=s.create(),l=s.create();o.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(l,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,l),s.dot(c,l)};var u=s.create();o.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),s.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),s.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),s.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),s.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),s.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),s.normalize(u,this.forwardEquation.t),s.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var r=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(r,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function r(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,r=[o.fromValues(-e/2,-i/2),o.fromValues(e/2,-i/2),o.fromValues(e/2,i/2),o.fromValues(-e/2,i/2)],a=[o.fromValues(1,0),o.fromValues(0,1)];t.vertices=r,t.axes=a,t.type=s.BOX,n.call(this,t)}var o=t("../math/vec2"),s=t("./Shape"),n=t("./Convex");e.exports=r,r.prototype=new n,r.prototype.constructor=r,r.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},r.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};o.create(),o.create(),o.create(),o.create();r.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},r.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function r(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=o.CAPSULE,o.call(this,t)}var o=t("./Shape"),s=t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,r=2*e;return t*(r*r+i*i)/12},r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},r.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var n=s.create();r.prototype.computeAABB=function(t,e,i){var r=this.radius;s.set(n,this.length/2,0),0!==i&&s.rotate(n,n,i),s.set(t.upperBound,Math.max(n[0]+r,-n[0]+r),Math.max(n[1]+r,-n[1]+r)),s.set(t.lowerBound,Math.min(n[0]-r,-n[0]-r),Math.min(n[1]-r,-n[1]-r)),s.add(t.lowerBound,t.lowerBound,e),s.add(t.upperBound,t.upperBound,e)};var a=s.create(),h=s.create(),c=s.create(),l=s.create(),u=s.fromValues(0,1);r.prototype.raycast=function(t,e,i,r){for(var o=e.from,n=e.to,p=(e.direction,a),d=h,f=c,v=l,g=this.length/2,y=0;y<2;y++){var m=this.radius*(2*y-1);s.set(f,-g,m),s.set(v,g,m),s.toGlobalFrame(f,f,i,r),s.toGlobalFrame(v,v,i,r);var b=s.getLineSegmentsIntersectionFraction(o,n,f,v);if(b>=0&&(s.rotate(d,u,r),s.scale(d,d,2*y-1),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}for(var x=Math.pow(this.radius,2)+Math.pow(g,2),y=0;y<2;y++){s.set(f,g*(2*y-1),0),s.toGlobalFrame(f,f,i,r);var A=Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2),E=2*((n[0]-o[0])*(o[0]-f[0])+(n[1]-o[1])*(o[1]-f[1])),B=Math.pow(o[0]-f[0],2)+Math.pow(o[1]-f[1],2)-Math.pow(this.radius,2),b=Math.pow(E,2)-4*A*B;if(!(b<0))if(0===b){if(s.lerp(p,o,n,b),s.squaredDistance(p,i)>x&&(s.sub(d,p,f),s.normalize(d,d),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}else{var S=Math.sqrt(b),T=1/(2*A),w=(-E-S)*T,R=(-E+S)*T;if(w>=0&&w<=1&&(s.lerp(p,o,n,w),s.squaredDistance(p,i)>x&&(s.sub(d,p,f),s.normalize(d,d),e.reportIntersection(t,w,d,-1),t.shouldStop(e))))return;if(R>=0&&R<=1&&(s.lerp(p,o,n,R),s.squaredDistance(p,i)>x&&(s.sub(d,p,f),s.normalize(d,d),e.reportIntersection(t,R,d,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function r(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=o.CIRCLE,o.call(this,t)}var o=t("./Shape"),s=t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},r.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},r.prototype.computeAABB=function(t,e,i){var r=this.radius;s.set(t.upperBound,r,r),s.set(t.lowerBound,-r,-r),e&&(s.add(t.lowerBound,t.lowerBound,e),s.add(t.upperBound,t.upperBound,e))};var n=s.create(),a=s.create();r.prototype.raycast=function(t,e,i,r){var o=e.from,h=e.to,c=this.radius,l=Math.pow(h[0]-o[0],2)+Math.pow(h[1]-o[1],2),u=2*((h[0]-o[0])*(o[0]-i[0])+(h[1]-o[1])*(o[1]-i[1])),p=Math.pow(o[0]-i[0],2)+Math.pow(o[1]-i[1],2)-Math.pow(c,2),d=Math.pow(u,2)-4*l*p,f=n,v=a;if(!(d<0))if(0===d)s.lerp(f,o,h,d),s.sub(v,f,i),s.normalize(v,v),e.reportIntersection(t,d,v,-1);else{var g=Math.sqrt(d),y=1/(2*l),m=(-u-g)*y,b=(-u+g)*y;if(m>=0&&m<=1&&(s.lerp(f,o,h,m),s.sub(v,f,i),s.normalize(v,v),e.reportIntersection(t,m,v,-1),t.shouldStop(e)))return;b>=0&&b<=1&&(s.lerp(f,o,h,b),s.sub(v,f,i),s.normalize(v,v),e.reportIntersection(t,b,v,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function r(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var r=s.create();s.copy(r,e[i]),this.vertices.push(r)}if(this.axes=[],t.axes)for(var i=0;i<t.axes.length;i++){var n=s.create();s.copy(n,t.axes[i]),this.axes.push(n)}else for(var i=0;i<this.vertices.length;i++){var a=this.vertices[i],h=this.vertices[(i+1)%this.vertices.length],c=s.create();s.sub(c,h,a),s.rotate90cw(c,c),s.normalize(c,c),this.axes.push(c)}if(this.centerOfMass=s.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=o.CONVEX,o.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var o=t("./Shape"),s=t("../math/vec2"),n=t("../math/polyk");t("poly-decomp");e.exports=r,r.prototype=new o,r.prototype.constructor=r;var a=s.create(),h=s.create();r.prototype.projectOntoLocalAxis=function(t,e){for(var i,r,o=null,n=null,t=a,h=0;h<this.vertices.length;h++)i=this.vertices[h],r=s.dot(i,t),(null===o||r>o)&&(o=r),(null===n||r<n)&&(n=r);if(n>o){var c=n;n=o,o=c}s.set(e,n,o)},r.prototype.projectOntoWorldAxis=function(t,e,i,r){var o=h;this.projectOntoLocalAxis(t,r),0!==i?s.rotate(o,t,i):o=t;var n=s.dot(e,o);s.set(r,r[0]+n,r[1]+n)},r.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var r=n.Triangulate(t),e=0;e<r.length;e+=3){var o=r[e],s=r[e+1],a=r[e+2];this.triangles.push([o,s,a])}};var c=s.create(),l=s.create(),u=s.create(),p=s.create(),d=s.create();s.create(),s.create(),s.create(),s.create();r.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,o=c,n=u,a=p,h=d,f=l;s.set(i,0,0);for(var v=0,g=0;g!==t.length;g++){var y=t[g],n=e[y[0]],a=e[y[1]],h=e[y[2]];s.centroid(o,n,a,h);var m=r.triangleArea(n,a,h);v+=m,s.scale(f,o,m),s.add(i,i,f)}s.scale(i,i,1/v)},r.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,r=this.vertices.length,o=r-1,n=0;n<r;o=n,n++){var a=this.vertices[o],h=this.vertices[n],c=Math.abs(s.crossLength(a,h)),l=s.dot(h,h)+s.dot(h,a)+s.dot(a,a);e+=c*l,i+=c}return t/6*(e/i)},r.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var r=s.squaredLength(t[i]);r>e&&(e=r)}this.boundingRadius=Math.sqrt(e)},r.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},r.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var o=t[i],s=e[o[0]],n=e[o[1]],a=e[o[2]],h=r.triangleArea(s,n,a);this.area+=h}},r.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var f=s.create(),v=s.create(),g=s.create();r.prototype.raycast=function(t,e,i,r){var o=f,n=v,a=g,h=this.vertices;s.toLocalFrame(o,e.from,i,r),s.toLocalFrame(n,e.to,i,r);for(var c=h.length,l=0;l<c&&!t.shouldStop(e);l++){var u=h[l],p=h[(l+1)%c],d=s.getLineSegmentsIntersectionFraction(o,n,u,p);d>=0&&(s.sub(a,p,u),s.rotate(a,a,-Math.PI/2+r),s.normalize(a,a),e.reportIntersection(t,d,a,l))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function r(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=o.HEIGHTFIELD,o.call(this,t)}var o=t("./Shape"),s=t("../math/vec2");t("../utils/Utils");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],r=0;r!==t.length;r++){var o=t[r];o>e&&(e=o),o<i&&(i=o)}this.maxValue=e,this.minValue=i},r.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},r.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},r.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var n=[s.create(),s.create(),s.create(),s.create()];r.prototype.computeAABB=function(t,e,i){s.set(n[0],0,this.maxValue),s.set(n[1],this.elementWidth*this.heights.length,this.maxValue),s.set(n[2],this.elementWidth*this.heights.length,this.minValue),s.set(n[3],0,this.minValue),t.setFromPoints(n,e,i)},r.prototype.getLineSegment=function(t,e,i){var r=this.heights,o=this.elementWidth;s.set(t,i*o,r[i]),s.set(e,(i+1)*o,r[i+1])},r.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},r.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var a=(s.create(),s.create()),h=s.create(),c=s.create(),l=s.create(),u=s.create();s.fromValues(0,1);r.prototype.raycast=function(t,e,i,r){var o=e.from,n=e.to,p=(e.direction,a),d=h,f=c,v=l,g=u;s.toLocalFrame(v,o,i,r),s.toLocalFrame(g,n,i,r);var y=this.getClampedSegmentIndex(v),m=this.getClampedSegmentIndex(g);if(y>m){var b=y;y=m,m=b}for(var x=0;x<this.heights.length-1;x++){this.getLineSegment(d,f,x);var A=s.getLineSegmentsIntersectionFraction(v,g,d,f);if(A>=0&&(s.sub(p,f,d),s.rotate(p,p,r+Math.PI/2),s.normalize(p,p),e.reportIntersection(t,A,p,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function r(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=o.LINE,o.call(this,t)}var o=t("./Shape"),s=t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var n=[s.create(),s.create()];r.prototype.computeAABB=function(t,e,i){var r=this.length/2;s.set(n[0],-r,0),s.set(n[1],r,0),t.setFromPoints(n,e,i,0)};var a=(s.create(),s.create()),h=s.create(),c=s.create(),l=s.fromValues(0,1);r.prototype.raycast=function(t,e,i,r){var o=e.from,n=e.to,u=h,p=c,d=this.length/2;s.set(u,-d,0),s.set(p,d,0),s.toGlobalFrame(u,u,i,r),s.toGlobalFrame(p,p,i,r);var f=s.getLineSegmentsIntersectionFraction(u,p,o,n);if(f>=0){var v=a;s.rotate(v,l,r),e.reportIntersection(t,f,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function r(t){t=t||{},t.type=o.PARTICLE,o.call(this,t)}var o=t("./Shape"),s=t("../math/vec2");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeMomentOfInertia=function(t){return 0},r.prototype.updateBoundingRadius=function(){this.boundingRadius=0},r.prototype.computeAABB=function(t,e,i){s.copy(t.lowerBound,e),s.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function r(t){t=t||{},t.type=o.PLANE,o.call(this,t)}var o=t("./Shape"),s=t("../math/vec2");t("../utils/Utils");e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.computeMomentOfInertia=function(t){return 0},r.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},r.prototype.computeAABB=function(t,e,i){var r=i%(2*Math.PI),o=s.set,n=Number.MAX_VALUE,a=t.lowerBound,h=t.upperBound;0===r?(o(a,-n,-n),o(h,n,0)):r===Math.PI/2?(o(a,0,-n),o(h,n,n)):r===Math.PI?(o(a,-n,0),o(h,n,n)):r===3*Math.PI/2?(o(a,-n,-n),o(h,0,n)):(o(a,-n,-n),o(h,n,n)),s.add(a,a,e),s.add(h,h,e)},r.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var n=s.create(),a=(s.create(),s.create(),s.create()),h=s.create();r.prototype.raycast=function(t,e,i,r){var o=e.from,c=e.to,l=e.direction,u=n,p=a,d=h;s.set(p,0,1),s.rotate(p,p,r),s.sub(d,o,i);var f=s.dot(d,p);s.sub(d,c,i);var v=s.dot(d,p);if(!(f*v>0||s.squaredDistance(o,c)<f*f)){var g=s.dot(p,l);s.sub(u,o,i);var y=-s.dot(p,u)/g/e.length;e.reportIntersection(t,y,p,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function r(t){t=t||{},this.body=null,this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=r.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=r;var o=t("../math/vec2");r.idCounter=0,r.CIRCLE=1,r.PARTICLE=2,r.PLANE=4,r.CONVEX=8,r.LINE=16,r.BOX=32,Object.defineProperty(r,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),r.BOX}}),r.CAPSULE=64,r.HEIGHTFIELD=128,r.prototype.computeMomentOfInertia=function(t){},r.prototype.updateBoundingRadius=function(){},r.prototype.updateArea=function(){},r.prototype.computeAABB=function(t,e,i){},r.prototype.raycast=function(t,e,i,r){}},{"../math/vec2":30}],46:[function(t,e,i){function r(t){n.call(this,t,n.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new a.ARRAY_TYPE(this.arrayStep),this.Bs=new a.ARRAY_TYPE(this.arrayStep),this.invCs=new a.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function o(t){for(var e=t.length;e--;)t[e]=0}var s=t("../math/vec2"),n=t("./Solver"),a=t("../utils/Utils"),h=t("../equations/FrictionEquation");e.exports=r,r.prototype=new n,r.prototype.constructor=r,r.prototype.solve=function(t,e){this.sortEquations();var i=0,n=this.iterations,c=this.frictionIterations,l=this.equations,u=l.length,p=Math.pow(this.tolerance*u,2),d=e.bodies,f=e.bodies.length,v=(s.add,s.set,this.useZeroRHS),g=this.lambda;if(this.usedIterations=0,u)for(var y=0;y!==f;y++){var m=d[y];m.updateSolveMassProperties()}g.length<u&&(g=this.lambda=new a.ARRAY_TYPE(u+this.arrayStep),this.Bs=new a.ARRAY_TYPE(u+this.arrayStep),this.invCs=new a.ARRAY_TYPE(u+this.arrayStep)),o(g);for(var b=this.invCs,x=this.Bs,g=this.lambda,y=0;y!==l.length;y++){var A=l[y];(A.timeStep!==t||A.needsUpdate)&&(A.timeStep=t,A.update()),x[y]=A.computeB(A.a,A.b,t),b[y]=A.computeInvC(A.epsilon)}var A,E,y,B;if(0!==u){for(y=0;y!==f;y++){var m=d[y];m.resetConstraintVelocity()}if(c){for(i=0;i!==c;i++){for(E=0,B=0;B!==u;B++){A=l[B];var S=r.iterateEquation(B,A,A.epsilon,x,b,g,v,t,i);E+=Math.abs(S)}if(this.usedIterations++,E*E<=p)break}for(r.updateMultipliers(l,g,1/t),B=0;B!==u;B++){var T=l[B];if(T instanceof h){for(var w=0,R=0;R!==T.contactEquations.length;R++)w+=T.contactEquations[R].multiplier;w*=T.frictionCoefficient/T.contactEquations.length,T.maxForce=w,T.minForce=-w}}}for(i=0;i!==n;i++){for(E=0,B=0;B!==u;B++){A=l[B];var S=r.iterateEquation(B,A,A.epsilon,x,b,g,v,t,i);E+=Math.abs(S)}if(this.usedIterations++,E*E<=p)break}for(y=0;y!==f;y++)d[y].addConstraintVelocity();r.updateMultipliers(l,g,1/t)}},r.updateMultipliers=function(t,e,i){for(var r=t.length;r--;)t[r].multiplier=e[r]*i},r.iterateEquation=function(t,e,i,r,o,s,n,a,h){var c=r[t],l=o[t],u=s[t],p=e.computeGWlambda(),d=e.maxForce,f=e.minForce;n&&(c=0);var v=l*(c-p-i*u),g=u+v;return g<f*a?v=f*a-u:g>d*a&&(v=d*a-u),s[t]+=v,e.addToWlambda(v),v}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function r(t,e){t=t||{},o.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var o=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=r,r.prototype=new o,r.prototype.constructor=r,r.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var s={bodies:[]};r.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),s.bodies.length=0,e.getBodies(s.bodies),s.bodies.length&&this.solve(t,s))},r.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},r.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},r.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var r=t[e];r.enabled&&this.equations.push(r)}},r.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);e!==-1&&this.equations.splice(e,1)},r.prototype.removeAllEquations=function(){this.equations.length=0},r.GS=1,r.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function r(){s.apply(this,arguments)}var o=t("../equations/ContactEquation"),s=t("./Pool");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.create=function(){return new o},r.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function r(){s.apply(this,arguments)}var o=t("../equations/FrictionEquation"),s=t("./Pool");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.create=function(){return new o},r.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function r(){s.apply(this,arguments)}var o=t("../world/IslandNode"),s=t("./Pool");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.create=function(){return new o},r.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function r(){s.apply(this,arguments)}var o=t("../world/Island"),s=t("./Pool");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.create=function(){return new o},r.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function r(){this.overlappingShapesLastState=new o,this.overlappingShapesCurrentState=new o,this.recordPool=new s({size:16}),this.tmpDict=new o,this.tmpArray1=[]}var o=t("./TupleDictionary"),s=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");e.exports=r,r.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var r=t.keys[i],o=t.getByKey(r);e.getByKey(r);o&&this.recordPool.release(o)}t.reset(),t.copy(e),e.reset()},r.prototype.setOverlapping=function(t,e,i,r){var o=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!o.get(e.id,r.id)){var s=this.recordPool.get();s.set(t,e,i,r),o.set(e.id,r.id,s)}},r.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},r.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},r.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,r=i.keys.length;r--;){var o=i.keys[r],s=i.data[o];if(s.bodyA===t&&s.bodyB===e||s.bodyA===e&&s.bodyB===t)return!0}return!1},r.prototype.getDiff=function(t,e,i){var i=i||[],r=t,o=e;i.length=0;for(var s=o.keys.length;s--;){var n=o.keys[s],a=o.data[n];if(!a)throw new Error("Key "+n+" had no data!");var h=r.data[n];h||i.push(a)}return i},r.prototype.isNewOverlap=function(t,e){var i=0|t.id,r=0|e.id,o=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;return!o.get(i,r)&&!!s.get(i,r)},r.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},r.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},r.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,r=t.length;r--;){var o=t[r];i.set(0|o.bodyA.id,0|o.bodyB.id,o)}for(r=i.keys.length;r--;){var o=i.getByKey(i.keys[r]);o&&e.push(o.bodyA,o.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function r(t,e,i,r){this.shapeA=e,this.shapeB=r,this.bodyA=t,this.bodyB=i}e.exports=r,r.prototype.set=function(t,e,i,o){r.call(this,t,e,i,o)}},{}],54:[function(t,e,i){function r(){s.apply(this,arguments)}var o=t("./OverlapKeeperRecord"),s=t("./Pool");e.exports=r,r.prototype=new s,r.prototype.constructor=r,r.prototype.create=function(){return new o},r.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function r(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=r,r.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},r.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},r.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function r(){this.data={},this.keys=[]}var o=t("./Utils");e.exports=r,r.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},r.prototype.getByKey=function(t){return t=0|t,this.data[t]},r.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},r.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var r=this.getKey(t,e);return this.data[r]||this.keys.push(r),this.data[r]=i,r},r.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},r.prototype.copy=function(t){this.reset(),o.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function r(){}e.exports=r,r.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,r=e.length;i!==r;++i)t.push(e[i])},r.splice=function(t,e,i){i=i||1;for(var r=e,o=t.length-i;r<o;r++)t[r]=t[r+i];t.length=o},"undefined"!=typeof P2_ARRAY_TYPE?r.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?r.ARRAY_TYPE=Float32Array:r.ARRAY_TYPE=Array,r.extend=function(t,e){for(var i in e)t[i]=e[i]},r.defaults=function(t,e){t=t||{};for(var i in e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function r(){this.equations=[],this.bodies=[]}var o=t("../objects/Body");e.exports=r,r.prototype.reset=function(){this.equations.length=this.bodies.length=0};var s=[];r.prototype.getBodies=function(t){var e=t||[],i=this.equations;s.length=0;for(var r=0;r!==i.length;r++){var o=i[r];s.indexOf(o.bodyA.id)===-1&&(e.push(o.bodyA),s.push(o.bodyA.id)),s.indexOf(o.bodyB.id)===-1&&(e.push(o.bodyB),s.push(o.bodyB.id))}return e},r.prototype.wantsToSleep=function(){
for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===o.DYNAMIC&&!e.wantsToSleep)return!1}return!0},r.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},{"../objects/Body":31}],59:[function(t,e,i){function r(t){this.nodePool=new o({size:16}),this.islandPool=new s({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var o=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),s=t("./../utils/IslandPool"),n=t("../objects/Body");e.exports=r,r.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var r=t[i];if(!r.visited&&r.body.type===n.DYNAMIC)return r}return!1},r.prototype.visit=function(t,e,i){e.push(t.body);for(var r=t.equations.length,o=0;o!==r;o++){var s=t.equations[o];i.indexOf(s)===-1&&i.push(s)}},r.prototype.bfs=function(t,e,i){var o=this.queue;for(o.length=0,o.push(t),t.visited=!0,this.visit(t,e,i);o.length;)for(var s,a=o.pop();s=r.getUnvisitedNode(a.neighbors);)s.visited=!0,this.visit(s,e,i),s.body.type===n.DYNAMIC&&o.push(s)},r.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,o=this.equations;i.length;)this.nodePool.release(i.pop());for(var s=0;s!==e.length;s++){var n=this.nodePool.get();n.body=e[s],i.push(n)}for(var a=0;a!==o.length;a++){var h=o[a],s=e.indexOf(h.bodyA),c=e.indexOf(h.bodyB),l=i[s],u=i[c];l.neighbors.push(u),u.neighbors.push(l),l.equations.push(h),u.equations.push(h)}for(var p=this.islands,s=0;s<p.length;s++)this.islandPool.release(p[s]);p.length=0;for(var d;d=r.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(d,f.bodies,f.equations),p.push(f)}return p}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function r(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=r,r.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function r(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new o,this.narrowphase=new y(this),this.islandManager=new x,this.gravity=s.fromValues(0,-9.78),t.gravity&&s.copy(this.gravity,t.gravity),this.frictionGravity=s.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new g,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"==typeof t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=r.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new b}var o=t("../solver/GSSolver"),s=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),n=t("../shapes/Circle"),a=t("../shapes/Convex"),h=(t("../shapes/Line"),t("../shapes/Plane")),c=t("../shapes/Capsule"),l=t("../shapes/Particle"),u=t("../events/EventEmitter"),p=t("../objects/Body"),d=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),f=t("../material/ContactMaterial"),v=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),g=t("../collision/SAPBroadphase"),y=t("../collision/Narrowphase"),m=t("../utils/Utils"),b=t("../utils/OverlapKeeper"),x=t("./IslandManager");t("../objects/RotationalSpring");e.exports=r,r.prototype=new Object(u.prototype),r.prototype.constructor=r,r.NO_SLEEPING=1,r.BODY_SLEEPING=2,r.ISLAND_SLEEPING=4,r.prototype.addConstraint=function(t){this.constraints.push(t)},r.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},r.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);e!==-1&&m.splice(this.contactMaterials,e,1)},r.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,r=0,o=i.length;r!==o;r++){var s=i[r];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},r.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);e!==-1&&m.splice(this.constraints,e,1)};var A=(s.create(),s.create(),s.create(),s.create(),s.create(),s.create(),s.create()),E=s.fromValues(0,0),B=s.fromValues(0,0);s.fromValues(0,0),s.fromValues(0,0);r.prototype.step=function(t,e,i){if(i=i||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var r=0;this.accumulator>=t&&r<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,r++;for(var o=this.accumulator%t/t,n=0;n!==this.bodies.length;n++){var a=this.bodies[n];s.lerp(a.interpolatedPosition,a.previousPosition,a.position,o),a.interpolatedAngle=a.previousAngle+o*(a.angle-a.previousAngle)}}};var S=[];r.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,o=this.bodies,n=this.gravity,a=this.solver,h=this.bodies.length,c=this.broadphase,l=this.narrowphase,u=this.constraints,d=A,f=(s.scale,s.add),v=(s.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var g=s.length(this.gravity);0===g&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=g)}if(this.applyGravity)for(var y=0;y!==h;y++){var b=o[y],x=b.force;b.type===p.DYNAMIC&&b.sleepState!==p.SLEEPING&&(s.scale(d,n,b.mass*b.gravityScale),f(x,x,d))}if(this.applySpringForces)for(var y=0;y!==e;y++){var E=i[y];E.applyForce()}if(this.applyDamping)for(var y=0;y!==h;y++){var b=o[y];b.type===p.DYNAMIC&&b.applyDamping(t)}for(var B=c.getCollisionPairs(this),T=this.disabledBodyCollisionPairs,y=T.length-2;y>=0;y-=2)for(var w=B.length-2;w>=0;w-=2)(T[y]===B[w]&&T[y+1]===B[w+1]||T[y+1]===B[w]&&T[y]===B[w+1])&&B.splice(w,2);var R=u.length;for(y=0;y!==R;y++){var C=u[y];if(!C.collideConnected)for(var w=B.length-2;w>=0;w-=2)(C.bodyA===B[w]&&C.bodyB===B[w+1]||C.bodyB===B[w]&&C.bodyA===B[w+1])&&B.splice(w,2)}this.postBroadphaseEvent.pairs=B,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this);for(var y=0,P=B.length;y!==P;y+=2)for(var L=B[y],_=B[y+1],M=0,F=L.shapes.length;M!==F;M++)for(var I=L.shapes[M],q=I.position,U=I.angle,O=0,N=_.shapes.length;O!==N;O++){var D=_.shapes[O],G=D.position,V=D.angle,k=this.defaultContactMaterial;if(I.material&&D.material){var W=this.getContactMaterial(I.material,D.material);W&&(k=W)}this.runNarrowphase(l,L,I,q,U,_,D,G,V,k,this.frictionGravity)}for(var y=0;y!==h;y++){var j=o[y];j._wakeUpAfterNarrowphase&&(j.wakeUp(),j._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(S);for(var Y=this.endContactEvent,O=S.length;O--;){var X=S[O];Y.shapeA=X.shapeA,Y.shapeB=X.shapeB,Y.bodyA=X.bodyA,Y.bodyB=X.bodyB,this.emit(Y)}S.length=0}var z=this.preSolveEvent;z.contactEquations=l.contactEquations,z.frictionEquations=l.frictionEquations,this.emit(z),z.contactEquations=z.frictionEquations=null;var R=u.length;for(y=0;y!==R;y++)u[y].update();if(l.contactEquations.length||l.frictionEquations.length||R)if(this.islandSplit){for(v.equations.length=0,m.appendArray(v.equations,l.contactEquations),m.appendArray(v.equations,l.frictionEquations),y=0;y!==R;y++)m.appendArray(v.equations,u[y].equations);v.split(this);for(var y=0;y!==v.islands.length;y++){var H=v.islands[y];H.equations.length&&a.solveIsland(t,H)}}else{for(a.addEquations(l.contactEquations),a.addEquations(l.frictionEquations),y=0;y!==R;y++)a.addEquations(u[y].equations);this.solveConstraints&&a.solve(t,this),a.removeAllEquations()}for(var y=0;y!==h;y++){var j=o[y];j.integrate(t)}for(var y=0;y!==h;y++)o[y].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var K=this.impactEvent,y=0;y!==l.contactEquations.length;y++){var Q=l.contactEquations[y];Q.firstImpact&&(K.bodyA=Q.bodyA,K.bodyB=Q.bodyB,K.shapeA=Q.shapeA,K.shapeB=Q.shapeB,K.contactEquation=Q,this.emit(K))}if(this.sleepMode===r.BODY_SLEEPING)for(y=0;y!==h;y++)o[y].sleepTick(this.time,!1,t);else if(this.sleepMode===r.ISLAND_SLEEPING&&this.islandSplit){for(y=0;y!==h;y++)o[y].sleepTick(this.time,!0,t);for(var y=0;y<this.islandManager.islands.length;y++){var H=this.islandManager.islands[y];H.wantsToSleep()&&H.sleep()}}this.stepping=!1;for(var Z=this.bodiesToBeRemoved,y=0;y!==Z.length;y++)this.removeBody(Z[y]);Z.length=0,this.emit(this.postStepEvent)},r.prototype.runNarrowphase=function(t,e,i,r,o,n,a,h,c,l,u){if(0!==(i.collisionGroup&a.collisionMask)&&0!==(a.collisionGroup&i.collisionMask)){s.rotate(E,r,e.angle),s.rotate(B,h,n.angle),s.add(E,E,e.position),s.add(B,B,n.position);var d=o+e.angle,f=c+n.angle;t.enableFriction=l.friction>0,t.frictionCoefficient=l.friction;var v;v=e.type===p.STATIC||e.type===p.KINEMATIC?n.mass:n.type===p.STATIC||n.type===p.KINEMATIC?e.mass:e.mass*n.mass/(e.mass+n.mass),t.slipForce=l.friction*u*v,t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&n.collisionResponse&&i.collisionResponse&&a.collisionResponse;var g=t[i.type|a.type],y=0;if(g){var m=i.sensor||a.sensor,b=t.frictionEquations.length;y=i.type<a.type?g.call(t,e,i,E,d,n,a,B,f,m):g.call(t,n,a,B,f,e,i,E,d,m);var x=t.frictionEquations.length-b;if(y){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&n.sleepState===p.AWAKE&&n.type!==p.STATIC){var A=s.squaredLength(n.velocity)+Math.pow(n.angularVelocity,2),S=Math.pow(n.sleepSpeedLimit,2);A>=2*S&&(e._wakeUpAfterNarrowphase=!0)}if(n.allowSleep&&n.type===p.DYNAMIC&&n.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var T=s.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),w=Math.pow(e.sleepSpeedLimit,2);T>=2*w&&(n._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,n,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,a)){var R=this.beginContactEvent;if(R.shapeA=i,R.shapeB=a,R.bodyA=e,R.bodyB=n,R.contactEquations.length=0,"number"==typeof y)for(var C=t.contactEquations.length-y;C<t.contactEquations.length;C++)R.contactEquations.push(t.contactEquations[C]);this.emit(R)}if("number"==typeof y&&x>1)for(var C=t.frictionEquations.length-x;C<t.frictionEquations.length;C++){var P=t.frictionEquations[C];P.setSlipForce(P.getSlipForce()/x)}}}}},r.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},r.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);e!==-1&&m.splice(this.springs,e,1)},r.prototype.addBody=function(t){if(this.bodies.indexOf(t)===-1){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},r.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);e!==-1&&(m.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},r.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var r=e[i];if(r.id===t)return r}return!1},r.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},r.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,r=0;r<i.length;r+=2)if(i[r]===t&&i[r+1]===e||i[r+1]===t&&i[r]===e)return void i.splice(r,2)},r.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;e>=0;e--)this.removeBody(i[e]);for(var o=this.springs,e=o.length-1;e>=0;e--)this.removeSpring(o[e]);for(var s=this.contactMaterials,e=s.length-1;e>=0;e--)this.removeContactMaterial(s[e]);r.apply(this)};var T=s.create(),w=(s.fromValues(0,0),s.fromValues(0,0));r.prototype.hitTest=function(t,e,i){i=i||0;var r=new p({position:t}),o=new l,u=t,d=0,f=T,v=w;r.addShape(o);for(var g=this.narrowphase,y=[],m=0,b=e.length;m!==b;m++)for(var x=e[m],A=0,E=x.shapes.length;A!==E;A++){var B=x.shapes[A];s.rotate(f,B.position,x.angle),s.add(f,f,x.position);var S=B.angle+x.angle;(B instanceof n&&g.circleParticle(x,B,f,S,r,o,u,d,!0)||B instanceof a&&g.particleConvex(r,o,u,d,x,B,f,S,!0)||B instanceof h&&g.particlePlane(r,o,u,d,x,B,f,S,!0)||B instanceof c&&g.particleCapsule(r,o,u,d,x,B,f,S,!0)||B instanceof l&&s.squaredLength(s.sub(v,f,t))<i*i)&&y.push(x)}return y},r.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var r=e[i],o=0;o!==r.equations.length;o++){var s=r.equations[o];s.stiffness=t,s.needsUpdate=!0}for(var n=this.contactMaterials,i=0;i!==n.length;i++){var r=n[i];r.stiffness=r.frictionStiffness=t}var r=this.defaultContactMaterial;r.stiffness=r.frictionStiffness=t},r.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],r=0;r!==i.equations.length;r++){var o=i.equations[r];o.relaxation=t,o.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var R=new v,C=[];r.prototype.raycast=function(t,e){return e.getAABB(R),this.broadphase.aabbQuery(this,R,C),e.intersectBodies(t,C),C.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});